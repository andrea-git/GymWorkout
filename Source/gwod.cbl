      *{TOTEM}PRG-COMMENT
      * gwod.Cbl
      * gwod.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          gwod.
       AUTHOR.              andre.
       DATE-WRITTEN.        giovedì 14 settembre 2023 16:47:50.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:gwod, INIT:gwod, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "exercises.sl".
           COPY "groups.sl".
           COPY "intensity.sl".
           COPY "macrogroups.sl".
           COPY "duration.sl".
           COPY "tmp-exe-effort.sl".
           COPY "wodbook.sl".
           COPY "wodmap.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "exercises.fd".
           COPY "groups.fd".
           COPY "intensity.fd".
           COPY "macrogroups.fd".
           COPY "duration.fd".
           COPY "tmp-exe-effort.fd".
           COPY "wodbook.fd".
           COPY "wodmap.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "comune.def".
               COPY "custom.def".
               COPY "UTYDATA.DEF".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
          88 Screen-Time-Out VALUE 99.
      * Properties & User defined Working Stoarge
       78 titolo VALUE IS "Gestione WOD". 
       77 num-param        PIC  9
                  USAGE IS COMP-1
                  VALUE IS 0.
       77 RigaCambiata     PIC  9(5)
                  VALUE IS 0.
       77 ColonnaCambiata  PIC  9(5)
                  VALUE IS 0.
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 val-ini          PIC  99/99/9999.
       77 store-ini        PIC  9(8).
       77 store-codice     PIC  9(5).
       77 data-oggi        PIC  9(8).
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 1.
       77 E-CANCELLA       PIC  9
                  VALUE IS 1.
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 1.
       77 E-MODIFICA       PIC  9
                  VALUE IS 1.
       77 E-STAMPA         PIC  9
                  VALUE IS 0.
       77 E-CERCA          PIC  9
                  VALUE IS 0.
       77 E-SELEZIONA      PIC  9
                  VALUE IS 1.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 Form1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 como-qta         PIC  9(6).
       77 link-stampante   PIC  x(200).
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 0,00.
       77 BOTTONE-annulla-BMP          PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Form1-Tb-1-Handlea
                  USAGE IS HANDLE OF WINDOW.
       01 tab-wod-exe.
           05 el-wod-day
                      OCCURS 7 TIMES.
               10 el-wod-mcg-exe
                          OCCURS 20 TIMES.
                   15 el-wod-mcg       PIC  x(5).
                   15 el-wod-exe-code  PIC  x(5).
                   15 el-wod-exe-desc  PIC  x(100).
                   15 el-wod-exe-effort            PIC  9.
       77 RigheIniziali    PIC  9(3).
       77 lastIdx          PIC  9(3).
       77 idx-days         PIC  9(3).
       77 idx-split        PIC  9(3).
       77 como-x           PIC  x.
       01 tot-mcg          PIC  99.
       01 tot-exe          PIC  99.
       01 como-tab-mcg.
           05 como-el-mcg-desc PIC  x(100)
                      OCCURS 10 TIMES.
       01 tab-mcg.
           05 el-mcg-desc      PIC  x(100)
                      OCCURS 10 TIMES.
       01 tab-exercises.
           05 el-tab-exercises
                      OCCURS 20 TIMES.
               10 el-exe-code      PIC  x(5).
               10 el-exe-desc      PIC  x(100).
               10 el-exe-used      PIC  9.
       77 tot-gruppi       PIC  999.
       77 idx-gruppi       PIC  999.
       01 tab-mgroups.
           05 el-mgroups
                      OCCURS 10 TIMES.
               10 el-mgroup        PIC  x(100).
               10 el-mcg-code      PIC  x(5).
       01 rec-grid.
           05 col-exercise     PIC  x(5).
           05 col-exe-desc     PIC  x(100).
           05 col-series       PIC  z9.
           05 col-reps         PIC  z9.
       77 Calibri14-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Calibri14B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 cambia-cliente-bmp           PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Calibri12-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Calibri12B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 contact-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 Calibri18B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 lab-scontoa-buf  PIC  X(8).
       77 default-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 lab-scont-buf    PIC  x.
       77 Calibri16B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 form-prezz-SF-HANDLE
                  USAGE IS HANDLE OF WINDOW.
       01 rec-prezzi.
           05 col-listino      PIC  9(5).
           05 col-descriz      PIC  x(50).
           05 col-valido       PIC  99/99/9999.
           05 col-per          PIC  X(50).
           05 col-prz1         PIC  zzz.zz9,99.
           05 col-prz2         PIC  zzz.zz9,99.
           05 col-prz3         PIC  zzz.zz9,99.
       77 STATUS-tlistini  PIC  X(2).
           88 Valid-STATUS-tlistini VALUE IS "00" THRU "09". 
       77 lab-art-buf      PIC  x(100).
       77 Calibri12BI-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 tsc-cliente      PIC  x(6).
       77 STATUS-exercises PIC  X(2).
           88 Valid-STATUS-exercises VALUE IS "00" THRU "09". 
       77 STATUS-groups    PIC  X(2).
           88 Valid-STATUS-groups VALUE IS "00" THRU "09". 
       77 STATUS-intensity PIC  X(2).
           88 Valid-STATUS-intensity VALUE IS "00" THRU "09". 
       77 STATUS-macrogroups           PIC  X(2).
           88 Valid-STATUS-macrogroups VALUE IS "00" THRU "09". 
       77 STATUS-wodbook   PIC  X(2).
           88 Valid-STATUS-wodbook VALUE IS "00" THRU "09". 
       77 LOGO-PICCOLO-BMP PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 cb-mg1-buf       PIC  X(100).
       77 cb-mg2-buf       PIC  X(100).
       77 cb-mg3-buf       PIC  X(100).
       77 cb-mg4-buf       PIC  X(100).
       77 cb-mg5-buf       PIC  X(100).
       77 cb-mgtb-buf      PIC  X(100).
       77 cb-int-buf       PIC  X(100).
       77 old-cb-dur-buf   PIC  X(100).
       77 STATUS-duration  PIC  X(2).
           88 Valid-STATUS-duration VALUE IS "00" THRU "09". 
       77 cb-rnd-buf       PIC  X(100).
       77 cb-dur-buf       PIC  X(100).
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 ex-remain        PIC  99.
       77 effort-wod       PIC  99.
       77 path-tmp-exe-effort          PIC  X(256).
       77 STATUS-tmp-exe-effort        PIC  X(2).
           88 Valid-STATUS-tmp-exe-effort VALUE IS "00" THRU "09". 
       77 cb-gio-buf       PIC  9.
       77 cb-mul-buf       PIC  X(100).
       77 cb-wod-buf       PIC  x(100).
       77 STATUS-wodmap    PIC  X(2).
           88 Valid-STATUS-wodmap VALUE IS "00" THRU "09". 
       77 cb-mg6-buf       PIC  X(100).

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-wodbook-RESTOREBUF  PIC X(2447).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(2447).
       77 TMP-DataSet1-exercises-BUF     PIC X(1189).
       77 TMP-DataSet1-groups-BUF     PIC X(1182).
       77 TMP-DataSet1-intensity-BUF     PIC X(1188).
       77 TMP-DataSet1-macrogroups-BUF     PIC X(1177).
       77 TMP-DataSet1-duration-BUF     PIC X(1163).
       77 TMP-DataSet1-tmp-exe-effort-BUF     PIC X(118).
       77 TMP-DataSet1-wodbook-BUF     PIC X(2447).
       77 TMP-DataSet1-wodmap-BUF     PIC X(1225).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-exercises-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-exercises-LOCK  VALUE "Y".
       77 DataSet1-exercises-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-exercises-KEY-Asc  VALUE "A".
          88 DataSet1-exercises-KEY-Desc VALUE "D".
       77 DataSet1-groups-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-groups-LOCK  VALUE "Y".
       77 DataSet1-groups-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-groups-KEY-Asc  VALUE "A".
          88 DataSet1-groups-KEY-Desc VALUE "D".
       77 DataSet1-intensity-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-intensity-LOCK  VALUE "Y".
       77 DataSet1-intensity-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-intensity-KEY-Asc  VALUE "A".
          88 DataSet1-intensity-KEY-Desc VALUE "D".
       77 DataSet1-macrogroups-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-macrogroups-LOCK  VALUE "Y".
       77 DataSet1-macrogroups-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-macrogroups-KEY-Asc  VALUE "A".
          88 DataSet1-macrogroups-KEY-Desc VALUE "D".
       77 DataSet1-duration-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-duration-LOCK  VALUE "Y".
       77 DataSet1-duration-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-duration-KEY-Asc  VALUE "A".
          88 DataSet1-duration-KEY-Desc VALUE "D".
       77 DataSet1-tmp-exe-effort-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-exe-effort-LOCK  VALUE "Y".
       77 DataSet1-tmp-exe-effort-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-exe-effort-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-exe-effort-KEY-Desc VALUE "D".
       77 DataSet1-wodbook-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-wodbook-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-wodbook-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-wodbook-KEY1-Asc  VALUE "A".
          88 DataSet1-wodbook-KEY1-Desc VALUE "D".
       77 DataSet1-wodmap-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-wodmap-LOCK  VALUE "Y".
       77 DataSet1-wodmap-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-wodmap-KEY-Asc  VALUE "A".
          88 DataSet1-wodmap-KEY-Desc VALUE "D".

       77 exercises-exe-k-desc-SPLITBUF  PIC X(101).
       77 exercises-exe-k-group-SPLITBUF  PIC X(11).
       77 groups-grp-k-desc-SPLITBUF  PIC X(101).
       77 intensity-int-k-desc-SPLITBUF  PIC X(101).
       77 intensity-int-kj-effort-SPLITBUF  PIC X(5).
       77 macrogroups-mcg-k-desc-SPLITBUF  PIC X(101).
       77 duration-dur-k-desc-SPLITBUF  PIC X(101).
       77 tmp-exe-effort-tee-k-mcg-eff-SPLITBUF  PIC X(8).
       77 tmp-exe-effort-tee-k-exe-multi-SPLITBUF  PIC X(7).
       77 wodmap-wom-k-desc-SPLITBUF  PIC X(101).

       78  78-col-data       value 1. 
       78  78-col-art        value 2. 
       78  78-col-des        value 3. 
       78  78-col-qta        value 4. 
       78  78-col-prz        value 5. 
       78  78-col-sc1        value 6. 
      ***** 78  78-col-sc2        value 7. 
       78  78-col-netto      value 7. 
       78  78-col-note       value 8. 
       78  78-col-numdoc     value 9. 
       78  78-col-datadoc    value 10. 

       78  78-max-colonne    value 10.

       77  como-riga         pic 9(4).

       01                    pic 9.
           88 controllo-finale  value 1 false zero.

       01                 pic 9.
           88 s-excell    value 1.
           88 s-stampa    value 2.
           88 s-anteprima value 3.

       77  messaggio      pic x(200).  

       01 OLD-tsc-rec.
           05 OLD-tsc-chiave.
               10 OLD-tsc-codice       PIC  9(6).
           05 OLD-tsc-dati.
               10 OLD-tsc-cliente      PIC  x(6).
               10 OLD-tsc-data-creazione           PIC  9(8).
               10 OLD-tsc-vuoti.
                   15 FILLER           PIC  9(18).
                   15 FILLER           PIC  9(18).
                   15 FILLER           PIC  9(18).
                   15 FILLER           PIC  x(500).

       01 OLD-rsc-rec.
           05 OLD-rsc-chiave.
               10 OLD-rsc-codice       PIC  9(6).
               10 OLD-rsc-data         PIC  9(8).
               10 OLD-rsc-articolo     PIC  x(6).
               10 OLD-rsc-riga         PIC  9(6).
           05 OLD-rsc-dati.
               10 OLD-rsc-cliente      PIC  x(6).
               10 OLD-rsc-qta          PIC  9(8).
               10 OLD-rsc-prz          PIC  9(6)v99.
               10 OLD-rsc-sconto       PIC  9(3)v99.
               10 OLD-rsc-netto        PIC  9(6)v99.
               10 OLD-rsc-note         PIC  x(150).
               10 OLD-rsc-fattura.
                   15 OLD-rsc-numfat       PIC  9(6).
                   15 OLD-rsc-datafat      PIC  9(8).
               10 OLD-rsc-corrisp.
                   15 OLD-rsc-numcor       PIC  9(6).
                   15 OLD-rsc-datacor      PIC  9(8).
               10 OLD-rsc-vuoti.
                   15 FILLER           PIC  9(18).
                   15 FILLER           PIC  9(18).
                   15 FILLER           PIC  9(18).
                   15 FILLER           PIC  x(500).
      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-gd1 VALUE 5001.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "F:\STUDIOPOSTURA\COPYLIB\BLOCKPGM.LKS".
       01 link-codice      PIC  9(6).

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           .

      * GRID
       05
           gd1, 
           Grid, 
           COL 2,00, 
           LINE 16,61,
           LINES 9,74 ,
           SIZE 61,90 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           DATA-COLUMNS (1, 6, 106, 108),
           ALIGNMENT ("U", "U", "R", "R"),
           SEPARATION (5, 5, 5, 5),
           DATA-TYPES ("U(5)", "X(100)", "z9", "z9"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 78-ID-gd1,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 60,
           VPADDING 5,
           VSCROLL,
           EVENT PROCEDURE Screen1-Gd-1-Event-Proc,
           .

      * BAR
       05
           Screen1-Br-1, 
           Bar,
           COL 1,00, 
           LINE 16,13,
           SIZE 113,50 ,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (9, 9),
           WIDTH 2,
           .

      * LABEL
       05
           Screen1-blockpgm-1, 
           Label, 
           COL 83,70, 
           LINE 1,00,
           LINES 0,61 ,
           SIZE 1,50 ,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-Custom1-1, 
           Label, 
           COL 90,70, 
           LINE 1,13,
           LINES 0,52 ,
           SIZE 0,80 ,
           ID IS 12,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-La-1a, 
           Label, 
           COL 3,00, 
           LINE 1,65,
           LINES 1,30 ,
           SIZE 13,00 ,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Macrogruppo 1",
           .

      * LABEL
       05
           Screen1-La-1aa, 
           Label, 
           COL 3,00, 
           LINE 3,13,
           LINES 1,30 ,
           SIZE 13,00 ,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Macrogruppo 2",
           .

      * LABEL
       05
           Screen1-La-1ab, 
           Label, 
           COL 3,00, 
           LINE 4,65,
           LINES 1,30 ,
           SIZE 13,00 ,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Macrogruppo 3",
           .

      * LABEL
       05
           Screen1-La-1ac, 
           Label, 
           COL 3,00, 
           LINE 6,13,
           LINES 1,30 ,
           SIZE 13,00 ,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Macrogruppo 4",
           .

      * LABEL
       05
           Screen1-La-1ad, 
           Label, 
           COL 3,00, 
           LINE 7,65,
           LINES 1,30 ,
           SIZE 13,00 ,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Macrogruppo 5",
           .

      * COMBO-BOX
       05
           cb-mg1, 
           Combo-Box, 
           COL 17,00, 
           LINE 1,65,
           LINES 6,00 ,
           SIZE 25,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           DROP-LIST,
           UNSORTED,
           VALUE cb-mg1-buf,
           AFTER PROCEDURE cb-mg1-AfterProcedure, 
           BEFORE PROCEDURE cb-mg1-BeforeProcedure, 
           .
      * COMBO-BOX
       05
           cb-mg2, 
           Combo-Box, 
           COL 17,00, 
           LINE 3,13,
           LINES 6,00 ,
           SIZE 25,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           DROP-LIST,
           UNSORTED,
           VALUE cb-mg2-buf,
           AFTER PROCEDURE cb-mg2-AfterProcedure, 
           BEFORE PROCEDURE cb-mg2-BeforeProcedure, 
           .
      * COMBO-BOX
       05
           cb-mg3, 
           Combo-Box, 
           COL 17,00, 
           LINE 4,65,
           LINES 6,00 ,
           SIZE 25,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           DROP-LIST,
           UNSORTED,
           VALUE cb-mg3-buf,
           AFTER PROCEDURE cb-mg3-AfterProcedure, 
           BEFORE PROCEDURE cb-mg3-BeforeProcedure, 
           .
      * COMBO-BOX
       05
           cb-mg4, 
           Combo-Box, 
           COL 17,00, 
           LINE 6,13,
           LINES 6,00 ,
           SIZE 25,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 11,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           DROP-LIST,
           UNSORTED,
           VALUE cb-mg4-buf,
           AFTER PROCEDURE cb-mg4-AfterProcedure, 
           BEFORE PROCEDURE cb-mg4-BeforeProcedure, 
           .
      * COMBO-BOX
       05
           cb-mg5, 
           Combo-Box, 
           COL 17,00, 
           LINE 7,65,
           LINES 6,00 ,
           SIZE 25,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           DROP-LIST,
           UNSORTED,
           VALUE cb-mg5-buf,
           AFTER PROCEDURE cb-mg5-AfterProcedure, 
           BEFORE PROCEDURE cb-mg5-BeforeProcedure, 
           .
      * LABEL
       05
           Screen1-La-2, 
           Label, 
           COL 3,00, 
           LINE 10,91,
           LINES 1,30 ,
           SIZE 13,00 ,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Total body",
           .

      * COMBO-BOX
       05
           cb-mgtb, 
           Combo-Box, 
           COL 17,00, 
           LINE 10,91,
           LINES 4,00 ,
           SIZE 25,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-SELCHANGE,
           DROP-LIST,
           UNSORTED,
           VALUE cb-mgtb-buf,
           AFTER PROCEDURE cb-mgtb-AfterProcedure, 
           BEFORE PROCEDURE cb-mgtb-BeforeProcedure, 
           .
      * LABEL
       05
           Screen1-La-2a, 
           Label, 
           COL 65,00, 
           LINE 1,65,
           LINES 1,30 ,
           SIZE 8,00 ,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Intensità",
           .

      * COMBO-BOX
       05
           cb-int, 
           Combo-Box, 
           COL 74,00, 
           LINE 1,65,
           LINES 6,00 ,
           SIZE 25,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-SELCHANGE,
           DROP-LIST,
           UNSORTED,
           VALUE cb-int-buf,
           AFTER PROCEDURE cb-int-AfterProcedure, 
           BEFORE PROCEDURE cb-int-BeforeProcedure, 
           .
      * LABEL
       05
           Screen1-La-2aa, 
           Label, 
           COL 65,00, 
           LINE 3,13,
           LINES 1,30 ,
           SIZE 8,00 ,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Durata",
           .

      * COMBO-BOX
       05
           cb-dur, 
           Combo-Box, 
           COL 74,00, 
           LINE 3,13,
           LINES 6,00 ,
           SIZE 25,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-SELCHANGE,
           DROP-LIST,
           UNSORTED,
           VALUE cb-dur-buf,
           AFTER PROCEDURE cb-dur-AfterProcedure, 
           BEFORE PROCEDURE cb-dur-BeforeProcedure, 
           .
      * LABEL
       05
           Screen1-La-2b, 
           Label, 
           COL 3,00, 
           LINE 12,48,
           LINES 1,30 ,
           SIZE 13,00 ,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Random",
           .

      * COMBO-BOX
       05
           cb-rnd, 
           Combo-Box, 
           COL 17,00, 
           LINE 12,48,
           LINES 4,00 ,
           SIZE 25,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 21,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-SELCHANGE,
           DROP-LIST,
           UNSORTED,
           VALUE cb-rnd-buf,
           AFTER PROCEDURE cb-rnd-AfterProcedure, 
           BEFORE PROCEDURE cb-rnd-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           pb-genera, 
           Push-Button, 
           COL 80,00, 
           LINE 10,00,
           LINES 3,30 ,
           SIZE 26,40 ,
           EXCEPTION-VALUE 1000,
           FONT IS Small-Font,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "GENERA",
           .

      * LABEL
       05
           Screen1-La-2aaa, 
           Label, 
           COL 65,00, 
           LINE 4,87,
           LINES 1,30 ,
           SIZE 8,00 ,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Giorni",
           .

      * COMBO-BOX
       05
           cb-gio, 
           Combo-Box, 
           COL 74,00, 
           LINE 4,87,
           LINES 6,00 ,
           SIZE 25,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 24,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-SELCHANGE,
           DROP-LIST,
           UNSORTED,
           VALUE cb-gio-buf,
           AFTER PROCEDURE cb-dur-AfterProcedure, 
           BEFORE PROCEDURE cb-dur-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           Screen1-Pb-1, 
           Push-Button, 
           COL 51,30, 
           LINE 2,91,
           LINES 1,48 ,
           SIZE 3,80 ,
           EXCEPTION-VALUE 1001,
           FONT IS Small-Font,
           ID IS 30,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Push Button",
           .

      * LABEL
       05
           Screen1-La-2ba, 
           Label, 
           COL 3,00, 
           LINE 14,22,
           LINES 1,30 ,
           SIZE 13,00 ,
           ID IS 31,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Multiarticolari",
           .

      * COMBO-BOX
       05
           cb-mul, 
           Combo-Box, 
           COL 17,00, 
           LINE 14,22,
           LINES 4,00 ,
           SIZE 25,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 32,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-SELCHANGE,
           DROP-LIST,
           UNSORTED,
           VALUE cb-mul-buf,
           AFTER PROCEDURE cb-rnd-AfterProcedure, 
           BEFORE PROCEDURE cb-rnd-BeforeProcedure, 
           .
      * LABEL
       05
           Screen1-La-2aaaa, 
           Label, 
           COL 65,00, 
           LINE 7,04,
           LINES 1,30 ,
           SIZE 8,00 ,
           ID IS 33,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Mappa",
           .

      * COMBO-BOX
       05
           cb-wod, 
           Combo-Box, 
           COL 74,00, 
           LINE 7,04,
           LINES 6,00 ,
           SIZE 25,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 34,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-SELCHANGE,
           DROP-LIST,
           UNSORTED,
           VALUE cb-wod-buf,
           AFTER PROCEDURE cb-dur-AfterProcedure, 
           BEFORE PROCEDURE cb-dur-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           pb-random, 
           Push-Button, 
           COL 50,30, 
           LINE 10,00,
           LINES 2,78 ,
           SIZE 7,60 ,
           EXCEPTION-VALUE 1002,
           FONT IS Small-Font,
           ID IS 25,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "RANDOM",
           .

      * LABEL
       05
           Screen1-La-1ada, 
           Label, 
           COL 3,00, 
           LINE 9,39,
           LINES 1,30 ,
           SIZE 13,00 ,
           ID IS 27,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Macrogruppo 6",
           .

      * COMBO-BOX
       05
           cb-mg6, 
           Combo-Box, 
           COL 17,00, 
           LINE 9,39,
           LINES 6,00 ,
           SIZE 25,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 28,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           DROP-LIST,
           UNSORTED,
           VALUE cb-mg6-buf,
           AFTER PROCEDURE cb-mg5-AfterProcedure, 
           BEFORE PROCEDURE cb-mg5-BeforeProcedure, 
           .
      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 72,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "Esci (Esc)",
           .

      * PUSH BUTTON
       05
           TOOL-NUOVO, 
           Push-Button, 
           COL 6,30, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-NUOVO,
           EXCEPTION-VALUE 2,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 73,
           SELF-ACT,
           TITLE "Nuovo (F2)",
           BITMAP-NUMBER BitmapNumNew
           .

      * PUSH BUTTON
       05
           TOOL-CANCELLA, 
           Push-Button, 
           COL 16,90, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-CANCELLA,
           EXCEPTION-VALUE 4,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 74,
           SELF-ACT,
           TITLE "Cancella (F4)",
           BITMAP-NUMBER BitmapNumDelete
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 11,60, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 75,
           SELF-ACT,
           TITLE "Salva (F3)",
           BITMAP-NUMBER BitmapNumSave
           .

      * PUSH BUTTON
       05
           TOOL-ANTEPRIMA, 
           Push-Button, 
           COL 27,50, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 6,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 6,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 76,
           SELF-ACT,
           TITLE "Anteprima (F6)",
           .

      * CHECK BOX
       05
           TOOL-MODIFICA, 
           Check-Box, 
           COL 22,20, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 5,
           FRAMED,
           SQUARE,
           ENABLED E-MODIFICA,
           EXCEPTION-VALUE 150
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 77,
           SELF-ACT,
           TITLE "Modifica (F5)",
           VALUE MOD,
           BITMAP-NUMBER BitmapNumEdit
           AFTER PROCEDURE TOOL-MODIFICA-AfterProcedure,
           BEFORE PROCEDURE TOOL-MODIFICA-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           TOOL-STAMPA, 
           Push-Button, 
           COL 32,80, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 7,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 7,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 110,
           SELF-ACT,
           TITLE "Stampa (F7)",
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 38,10, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 111,
           SELF-ACT,
           TITLE "Cerca (F8)",
           BITMAP-NUMBER BitmapNumZoom
           .

      * PUSH BUTTON
       05
           TOOL-SELEZIONA, 
           Push-Button, 
           COL 43,40, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 9,
           FRAMED,
           SQUARE,
           ENABLED E-SELEZIONA,
           EXCEPTION-VALUE 9,
           FLAT,
           FONT IS Calibri14-Occidentale,
           ID IS 112,
           SELF-ACT,
           TITLE "Seleziona (F9)",
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, link-codice.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:gwod, INIT:gwod, BeforeDeclarative>
       WODBOOK-ERROR SECTION.
           use after error procedure on WODBOOK.
           set RecLocked to false.
           evaluate status-WODBOOK
           when "35"
                display message "File [WODBOOK] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [WODBOOK] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[WODBOOK] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "99"
           when "93"
                set RecLocked to true
                set errori    to true
                move 0 to mod
                modify tool-modifica, value = mod
                move 1 to mod-k
                display form1
                set StatusVisua to true
                perform STATUS-BAR-MSG
                move "00" to status-wodbook
                if ReadSecca
                   read WODBOOK    no lock 
                        invalid      continue
                        not invalid  perform FORM1-IUD-DISPLAY
                   end-read
                end-if
                display message box MSG-Record-gia-in-uso
                        title = tit-err
                        icon is mb-error-icon
           when "23"
                move 1 to mod-k
                move 0 to mod
                modify tool-modifica, value = mod
                set StatusVisua to true
                perform STATUS-BAR-MSG 
                if nuovo              
                   initialize wod-data
                              replacing numeric data by zeroes
                                   alphanumeric data by spaces
                   perform FORM1-FLD-TO-BUF
                   display form1-tb-1
                   set vecchio to true
                end-if      
                perform ABILITAZIONI
                display form1
                |RISETTO IL VALORE A "23" PERCHE DENTRO AL PAR. CLEAR-SCREEN
                |CON L'OPERAZIONE UNLOCK VIENE RISETTATO A ZERO COSICCHÈ 
                |QUANDO TORNA DENTRO AI PAR. DI SCORRIMENTO DI TOTEM SI 
                |TROVA IN UNA SITUAZIONE CORRETTA E PROSEGUE CON LA READ
                |USCENDO CON UN MESSAGGIO DI ERRORE DI TIPO "46"
                move "23" to status-WODBOOK
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM ginqui-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:gwod, INIT:gwod, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Calibri14-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
      *    After-Program
           PERFORM ginqui-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Calibri14-Occidentale
           INITIALIZE WFONT-DATA Calibri14-Occidentale
           MOVE 14 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri14-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-exercises
           PERFORM OPEN-groups
           PERFORM OPEN-intensity
           PERFORM OPEN-macrogroups
           PERFORM OPEN-duration
      *    tmp-exe-effort OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-exe-effort
           PERFORM OPEN-wodbook
           PERFORM OPEN-wodmap
      *    After Open
           .

       OPEN-exercises.
      * <TOTEM:EPT. INIT:gwod, FD:exercises, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT exercises
           IF NOT Valid-STATUS-exercises
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gwod, FD:exercises, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-groups.
      * <TOTEM:EPT. INIT:gwod, FD:groups, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT groups
           IF NOT Valid-STATUS-groups
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gwod, FD:groups, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-intensity.
      * <TOTEM:EPT. INIT:gwod, FD:intensity, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT intensity
           IF NOT Valid-STATUS-intensity
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gwod, FD:intensity, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-macrogroups.
      * <TOTEM:EPT. INIT:gwod, FD:macrogroups, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT macrogroups
           IF NOT Valid-STATUS-macrogroups
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gwod, FD:macrogroups, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-duration.
      * <TOTEM:EPT. INIT:gwod, FD:duration, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT duration
           IF NOT Valid-STATUS-duration
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gwod, FD:duration, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-exe-effort.
      * <TOTEM:EPT. INIT:gwod, FD:tmp-exe-effort, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT tmp-exe-effort
           IF NOT Valid-STATUS-tmp-exe-effort
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gwod, FD:tmp-exe-effort, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-wodbook.
      * <TOTEM:EPT. INIT:gwod, FD:wodbook, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O wodbook
           IF STATUS-wodbook = "35"
              OPEN OUTPUT wodbook
                IF Valid-STATUS-wodbook
                   CLOSE wodbook
                   OPEN I-O wodbook
                END-IF
           END-IF
           IF NOT Valid-STATUS-wodbook
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gwod, FD:wodbook, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-wodmap.
      * <TOTEM:EPT. INIT:gwod, FD:wodmap, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT wodmap
           IF NOT Valid-STATUS-wodmap
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gwod, FD:wodmap, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-exercises
           PERFORM CLOSE-groups
           PERFORM CLOSE-intensity
           PERFORM CLOSE-macrogroups
           PERFORM CLOSE-duration
      *    tmp-exe-effort CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-exe-effort
           PERFORM CLOSE-wodbook
           PERFORM CLOSE-wodmap
      *    After Close
           .

       CLOSE-exercises.
      * <TOTEM:EPT. INIT:gwod, FD:exercises, BeforeClose>
      * <TOTEM:END>
           CLOSE exercises
           .

       CLOSE-groups.
      * <TOTEM:EPT. INIT:gwod, FD:groups, BeforeClose>
      * <TOTEM:END>
           CLOSE groups
           .

       CLOSE-intensity.
      * <TOTEM:EPT. INIT:gwod, FD:intensity, BeforeClose>
      * <TOTEM:END>
           CLOSE intensity
           .

       CLOSE-macrogroups.
      * <TOTEM:EPT. INIT:gwod, FD:macrogroups, BeforeClose>
      * <TOTEM:END>
           CLOSE macrogroups
           .

       CLOSE-duration.
      * <TOTEM:EPT. INIT:gwod, FD:duration, BeforeClose>
      * <TOTEM:END>
           CLOSE duration
           .

       CLOSE-tmp-exe-effort.
      * <TOTEM:EPT. INIT:gwod, FD:tmp-exe-effort, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-wodbook.
      * <TOTEM:EPT. INIT:gwod, FD:wodbook, BeforeClose>
      * <TOTEM:END>
           CLOSE wodbook
           .

       CLOSE-wodmap.
      * <TOTEM:EPT. INIT:gwod, FD:wodmap, BeforeClose>
      * <TOTEM:END>
           CLOSE wodmap
           .

       exercises-exe-k-desc-MERGE-SPLITBUF.
           INITIALIZE exercises-exe-k-desc-SPLITBUF
           MOVE exe-desc(1:100) TO exercises-exe-k-desc-SPLITBUF(1:100)
           .

       exercises-exe-k-group-MERGE-SPLITBUF.
           INITIALIZE exercises-exe-k-group-SPLITBUF
           MOVE exe-grp-code(1:5) TO exercises-exe-k-group-SPLITBUF(1:5)
           MOVE exe-key(1:5) TO exercises-exe-k-group-SPLITBUF(6:5)
           .

       DataSet1-exercises-INITSTART.
           IF DataSet1-exercises-KEY-Asc
              MOVE Low-Value TO exe-key
           ELSE
              MOVE High-Value TO exe-key
           END-IF
           .

       DataSet1-exercises-INITEND.
           IF DataSet1-exercises-KEY-Asc
              MOVE High-Value TO exe-key
           ELSE
              MOVE Low-Value TO exe-key
           END-IF
           .

      * exercises
       DataSet1-exercises-START.
           IF DataSet1-exercises-KEY-Asc
              START exercises KEY >= exe-key
           ELSE
              START exercises KEY <= exe-key
           END-IF
           .

       DataSet1-exercises-START-NOTGREATER.
           IF DataSet1-exercises-KEY-Asc
              START exercises KEY <= exe-key
           ELSE
              START exercises KEY >= exe-key
           END-IF
           .

       DataSet1-exercises-START-GREATER.
           IF DataSet1-exercises-KEY-Asc
              START exercises KEY > exe-key
           ELSE
              START exercises KEY < exe-key
           END-IF
           .

       DataSet1-exercises-START-LESS.
           IF DataSet1-exercises-KEY-Asc
              START exercises KEY < exe-key
           ELSE
              START exercises KEY > exe-key
           END-IF
           .

       DataSet1-exercises-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-exercises-LOCK
              READ exercises WITH LOCK 
              KEY exe-key
           ELSE
              READ exercises WITH NO LOCK 
              KEY exe-key
           END-IF
           PERFORM exercises-exe-k-desc-MERGE-SPLITBUF
           PERFORM exercises-exe-k-group-MERGE-SPLITBUF
           MOVE STATUS-exercises TO TOTEM-ERR-STAT 
           MOVE "exercises" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-exercises-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-exercises-KEY-Asc
              IF DataSet1-exercises-LOCK
                 READ exercises NEXT WITH LOCK
              ELSE
                 READ exercises NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-exercises-LOCK
                 READ exercises PREVIOUS WITH LOCK
              ELSE
                 READ exercises PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM exercises-exe-k-desc-MERGE-SPLITBUF
           PERFORM exercises-exe-k-group-MERGE-SPLITBUF
           MOVE STATUS-exercises TO TOTEM-ERR-STAT
           MOVE "exercises" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-exercises-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-exercises-KEY-Asc
              IF DataSet1-exercises-LOCK
                 READ exercises PREVIOUS WITH LOCK
              ELSE
                 READ exercises PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-exercises-LOCK
                 READ exercises NEXT WITH LOCK
              ELSE
                 READ exercises NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM exercises-exe-k-desc-MERGE-SPLITBUF
           PERFORM exercises-exe-k-group-MERGE-SPLITBUF
           MOVE STATUS-exercises TO TOTEM-ERR-STAT
           MOVE "exercises" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-exercises-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-exercises TO TOTEM-ERR-STAT
           MOVE "exercises" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-exercises-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-exercises TO TOTEM-ERR-STAT
           MOVE "exercises" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-exercises-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-exercises TO TOTEM-ERR-STAT
           MOVE "exercises" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterDelete>
      * <TOTEM:END>
           .

       groups-grp-k-desc-MERGE-SPLITBUF.
           INITIALIZE groups-grp-k-desc-SPLITBUF
           MOVE grp-desc(1:100) TO groups-grp-k-desc-SPLITBUF(1:100)
           .

       DataSet1-groups-INITSTART.
           IF DataSet1-groups-KEY-Asc
              MOVE Low-Value TO grp-key
           ELSE
              MOVE High-Value TO grp-key
           END-IF
           .

       DataSet1-groups-INITEND.
           IF DataSet1-groups-KEY-Asc
              MOVE High-Value TO grp-key
           ELSE
              MOVE Low-Value TO grp-key
           END-IF
           .

      * groups
       DataSet1-groups-START.
           IF DataSet1-groups-KEY-Asc
              START groups KEY >= grp-key
           ELSE
              START groups KEY <= grp-key
           END-IF
           .

       DataSet1-groups-START-NOTGREATER.
           IF DataSet1-groups-KEY-Asc
              START groups KEY <= grp-key
           ELSE
              START groups KEY >= grp-key
           END-IF
           .

       DataSet1-groups-START-GREATER.
           IF DataSet1-groups-KEY-Asc
              START groups KEY > grp-key
           ELSE
              START groups KEY < grp-key
           END-IF
           .

       DataSet1-groups-START-LESS.
           IF DataSet1-groups-KEY-Asc
              START groups KEY < grp-key
           ELSE
              START groups KEY > grp-key
           END-IF
           .

       DataSet1-groups-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:groups, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:groups, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-groups-LOCK
              READ groups WITH LOCK 
              KEY grp-key
           ELSE
              READ groups WITH NO LOCK 
              KEY grp-key
           END-IF
           PERFORM groups-grp-k-desc-MERGE-SPLITBUF
           MOVE STATUS-groups TO TOTEM-ERR-STAT 
           MOVE "groups" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:groups, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:groups, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-groups-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:groups, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:groups, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-groups-KEY-Asc
              IF DataSet1-groups-LOCK
                 READ groups NEXT WITH LOCK
              ELSE
                 READ groups NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-groups-LOCK
                 READ groups PREVIOUS WITH LOCK
              ELSE
                 READ groups PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM groups-grp-k-desc-MERGE-SPLITBUF
           MOVE STATUS-groups TO TOTEM-ERR-STAT
           MOVE "groups" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:groups, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:groups, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-groups-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:groups, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:groups, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-groups-KEY-Asc
              IF DataSet1-groups-LOCK
                 READ groups PREVIOUS WITH LOCK
              ELSE
                 READ groups PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-groups-LOCK
                 READ groups NEXT WITH LOCK
              ELSE
                 READ groups NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM groups-grp-k-desc-MERGE-SPLITBUF
           MOVE STATUS-groups TO TOTEM-ERR-STAT
           MOVE "groups" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:groups, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:groups, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-groups-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:groups, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-groups TO TOTEM-ERR-STAT
           MOVE "groups" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:groups, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-groups-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:groups, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-groups TO TOTEM-ERR-STAT
           MOVE "groups" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:groups, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-groups-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:groups, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-groups TO TOTEM-ERR-STAT
           MOVE "groups" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:groups, AfterDelete>
      * <TOTEM:END>
           .

       intensity-int-k-desc-MERGE-SPLITBUF.
           INITIALIZE intensity-int-k-desc-SPLITBUF
           MOVE int-desc(1:100) TO intensity-int-k-desc-SPLITBUF(1:100)
           .

       intensity-int-kj-effort-MERGE-SPLITBUF.
           INITIALIZE intensity-int-kj-effort-SPLITBUF
           MOVE int-effort(1:2) TO intensity-int-kj-effort-SPLITBUF(1:2)
           MOVE int-key(1:2) TO intensity-int-kj-effort-SPLITBUF(3:2)
           .

       DataSet1-intensity-INITSTART.
           IF DataSet1-intensity-KEY-Asc
              MOVE Low-Value TO int-key
           ELSE
              MOVE High-Value TO int-key
           END-IF
           .

       DataSet1-intensity-INITEND.
           IF DataSet1-intensity-KEY-Asc
              MOVE High-Value TO int-key
           ELSE
              MOVE Low-Value TO int-key
           END-IF
           .

      * intensity
       DataSet1-intensity-START.
           IF DataSet1-intensity-KEY-Asc
              START intensity KEY >= int-key
           ELSE
              START intensity KEY <= int-key
           END-IF
           .

       DataSet1-intensity-START-NOTGREATER.
           IF DataSet1-intensity-KEY-Asc
              START intensity KEY <= int-key
           ELSE
              START intensity KEY >= int-key
           END-IF
           .

       DataSet1-intensity-START-GREATER.
           IF DataSet1-intensity-KEY-Asc
              START intensity KEY > int-key
           ELSE
              START intensity KEY < int-key
           END-IF
           .

       DataSet1-intensity-START-LESS.
           IF DataSet1-intensity-KEY-Asc
              START intensity KEY < int-key
           ELSE
              START intensity KEY > int-key
           END-IF
           .

       DataSet1-intensity-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-intensity-LOCK
              READ intensity WITH LOCK 
              KEY int-key
           ELSE
              READ intensity WITH NO LOCK 
              KEY int-key
           END-IF
           PERFORM intensity-int-k-desc-MERGE-SPLITBUF
           PERFORM intensity-int-kj-effort-MERGE-SPLITBUF
           MOVE STATUS-intensity TO TOTEM-ERR-STAT 
           MOVE "intensity" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-intensity-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-intensity-KEY-Asc
              IF DataSet1-intensity-LOCK
                 READ intensity NEXT WITH LOCK
              ELSE
                 READ intensity NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-intensity-LOCK
                 READ intensity PREVIOUS WITH LOCK
              ELSE
                 READ intensity PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM intensity-int-k-desc-MERGE-SPLITBUF
           PERFORM intensity-int-kj-effort-MERGE-SPLITBUF
           MOVE STATUS-intensity TO TOTEM-ERR-STAT
           MOVE "intensity" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-intensity-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-intensity-KEY-Asc
              IF DataSet1-intensity-LOCK
                 READ intensity PREVIOUS WITH LOCK
              ELSE
                 READ intensity PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-intensity-LOCK
                 READ intensity NEXT WITH LOCK
              ELSE
                 READ intensity NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM intensity-int-k-desc-MERGE-SPLITBUF
           PERFORM intensity-int-kj-effort-MERGE-SPLITBUF
           MOVE STATUS-intensity TO TOTEM-ERR-STAT
           MOVE "intensity" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-intensity-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-intensity TO TOTEM-ERR-STAT
           MOVE "intensity" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-intensity-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-intensity TO TOTEM-ERR-STAT
           MOVE "intensity" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-intensity-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-intensity TO TOTEM-ERR-STAT
           MOVE "intensity" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:intensity, AfterDelete>
      * <TOTEM:END>
           .

       macrogroups-mcg-k-desc-MERGE-SPLITBUF.
           INITIALIZE macrogroups-mcg-k-desc-SPLITBUF
           MOVE mcg-desc(1:100) TO 
           macrogroups-mcg-k-desc-SPLITBUF(1:100)
           .

       DataSet1-macrogroups-INITSTART.
           IF DataSet1-macrogroups-KEY-Asc
              MOVE Low-Value TO mcg-key
           ELSE
              MOVE High-Value TO mcg-key
           END-IF
           .

       DataSet1-macrogroups-INITEND.
           IF DataSet1-macrogroups-KEY-Asc
              MOVE High-Value TO mcg-key
           ELSE
              MOVE Low-Value TO mcg-key
           END-IF
           .

      * macrogroups
       DataSet1-macrogroups-START.
           IF DataSet1-macrogroups-KEY-Asc
              START macrogroups KEY >= mcg-key
           ELSE
              START macrogroups KEY <= mcg-key
           END-IF
           .

       DataSet1-macrogroups-START-NOTGREATER.
           IF DataSet1-macrogroups-KEY-Asc
              START macrogroups KEY <= mcg-key
           ELSE
              START macrogroups KEY >= mcg-key
           END-IF
           .

       DataSet1-macrogroups-START-GREATER.
           IF DataSet1-macrogroups-KEY-Asc
              START macrogroups KEY > mcg-key
           ELSE
              START macrogroups KEY < mcg-key
           END-IF
           .

       DataSet1-macrogroups-START-LESS.
           IF DataSet1-macrogroups-KEY-Asc
              START macrogroups KEY < mcg-key
           ELSE
              START macrogroups KEY > mcg-key
           END-IF
           .

       DataSet1-macrogroups-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-macrogroups-LOCK
              READ macrogroups WITH LOCK 
              KEY mcg-key
           ELSE
              READ macrogroups WITH NO LOCK 
              KEY mcg-key
           END-IF
           PERFORM macrogroups-mcg-k-desc-MERGE-SPLITBUF
           MOVE STATUS-macrogroups TO TOTEM-ERR-STAT 
           MOVE "macrogroups" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-macrogroups-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-macrogroups-KEY-Asc
              IF DataSet1-macrogroups-LOCK
                 READ macrogroups NEXT WITH LOCK
              ELSE
                 READ macrogroups NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-macrogroups-LOCK
                 READ macrogroups PREVIOUS WITH LOCK
              ELSE
                 READ macrogroups PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM macrogroups-mcg-k-desc-MERGE-SPLITBUF
           MOVE STATUS-macrogroups TO TOTEM-ERR-STAT
           MOVE "macrogroups" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-macrogroups-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-macrogroups-KEY-Asc
              IF DataSet1-macrogroups-LOCK
                 READ macrogroups PREVIOUS WITH LOCK
              ELSE
                 READ macrogroups PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-macrogroups-LOCK
                 READ macrogroups NEXT WITH LOCK
              ELSE
                 READ macrogroups NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM macrogroups-mcg-k-desc-MERGE-SPLITBUF
           MOVE STATUS-macrogroups TO TOTEM-ERR-STAT
           MOVE "macrogroups" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-macrogroups-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-macrogroups TO TOTEM-ERR-STAT
           MOVE "macrogroups" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-macrogroups-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-macrogroups TO TOTEM-ERR-STAT
           MOVE "macrogroups" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-macrogroups-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-macrogroups TO TOTEM-ERR-STAT
           MOVE "macrogroups" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:macrogroups, AfterDelete>
      * <TOTEM:END>
           .

       duration-dur-k-desc-MERGE-SPLITBUF.
           INITIALIZE duration-dur-k-desc-SPLITBUF
           MOVE dur-desc(1:100) TO duration-dur-k-desc-SPLITBUF(1:100)
           .

       DataSet1-duration-INITSTART.
           IF DataSet1-duration-KEY-Asc
              MOVE Low-Value TO dur-key
           ELSE
              MOVE High-Value TO dur-key
           END-IF
           .

       DataSet1-duration-INITEND.
           IF DataSet1-duration-KEY-Asc
              MOVE High-Value TO dur-key
           ELSE
              MOVE Low-Value TO dur-key
           END-IF
           .

      * duration
       DataSet1-duration-START.
           IF DataSet1-duration-KEY-Asc
              START duration KEY >= dur-key
           ELSE
              START duration KEY <= dur-key
           END-IF
           .

       DataSet1-duration-START-NOTGREATER.
           IF DataSet1-duration-KEY-Asc
              START duration KEY <= dur-key
           ELSE
              START duration KEY >= dur-key
           END-IF
           .

       DataSet1-duration-START-GREATER.
           IF DataSet1-duration-KEY-Asc
              START duration KEY > dur-key
           ELSE
              START duration KEY < dur-key
           END-IF
           .

       DataSet1-duration-START-LESS.
           IF DataSet1-duration-KEY-Asc
              START duration KEY < dur-key
           ELSE
              START duration KEY > dur-key
           END-IF
           .

       DataSet1-duration-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:duration, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:duration, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-duration-LOCK
              READ duration WITH LOCK 
              KEY dur-key
           ELSE
              READ duration WITH NO LOCK 
              KEY dur-key
           END-IF
           PERFORM duration-dur-k-desc-MERGE-SPLITBUF
           MOVE STATUS-duration TO TOTEM-ERR-STAT 
           MOVE "duration" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:duration, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:duration, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-duration-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:duration, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:duration, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-duration-KEY-Asc
              IF DataSet1-duration-LOCK
                 READ duration NEXT WITH LOCK
              ELSE
                 READ duration NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-duration-LOCK
                 READ duration PREVIOUS WITH LOCK
              ELSE
                 READ duration PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM duration-dur-k-desc-MERGE-SPLITBUF
           MOVE STATUS-duration TO TOTEM-ERR-STAT
           MOVE "duration" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:duration, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:duration, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-duration-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:duration, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:duration, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-duration-KEY-Asc
              IF DataSet1-duration-LOCK
                 READ duration PREVIOUS WITH LOCK
              ELSE
                 READ duration PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-duration-LOCK
                 READ duration NEXT WITH LOCK
              ELSE
                 READ duration NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM duration-dur-k-desc-MERGE-SPLITBUF
           MOVE STATUS-duration TO TOTEM-ERR-STAT
           MOVE "duration" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:duration, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:duration, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-duration-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:duration, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-duration TO TOTEM-ERR-STAT
           MOVE "duration" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:duration, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-duration-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:duration, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-duration TO TOTEM-ERR-STAT
           MOVE "duration" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:duration, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-duration-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:duration, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-duration TO TOTEM-ERR-STAT
           MOVE "duration" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:duration, AfterDelete>
      * <TOTEM:END>
           .

       tmp-exe-effort-tee-k-mcg-eff-MERGE-SPLITBUF.
           INITIALIZE tmp-exe-effort-tee-k-mcg-eff-SPLITBUF
           MOVE tee-mcg-code(1:5) TO 
           tmp-exe-effort-tee-k-mcg-eff-SPLITBUF(1:5)
           MOVE tee-int-effort(1:2) TO 
           tmp-exe-effort-tee-k-mcg-eff-SPLITBUF(6:2)
           .

       tmp-exe-effort-tee-k-exe-multi-MERGE-SPLITBUF.
           INITIALIZE tmp-exe-effort-tee-k-exe-multi-SPLITBUF
           MOVE tee-exe-isMulti(1:1) TO 
           tmp-exe-effort-tee-k-exe-multi-SPLITBUF(1:1)
           MOVE tee-mcg-code(1:5) TO 
           tmp-exe-effort-tee-k-exe-multi-SPLITBUF(2:5)
           .

       DataSet1-tmp-exe-effort-INITSTART.
           IF DataSet1-tmp-exe-effort-KEY-Asc
              MOVE Low-Value TO tee-key
           ELSE
              MOVE High-Value TO tee-key
           END-IF
           .

       DataSet1-tmp-exe-effort-INITEND.
           IF DataSet1-tmp-exe-effort-KEY-Asc
              MOVE High-Value TO tee-key
           ELSE
              MOVE Low-Value TO tee-key
           END-IF
           .

      * tmp-exe-effort
       DataSet1-tmp-exe-effort-START.
           IF DataSet1-tmp-exe-effort-KEY-Asc
              START tmp-exe-effort KEY >= tee-key
           ELSE
              START tmp-exe-effort KEY <= tee-key
           END-IF
           .

       DataSet1-tmp-exe-effort-START-NOTGREATER.
           IF DataSet1-tmp-exe-effort-KEY-Asc
              START tmp-exe-effort KEY <= tee-key
           ELSE
              START tmp-exe-effort KEY >= tee-key
           END-IF
           .

       DataSet1-tmp-exe-effort-START-GREATER.
           IF DataSet1-tmp-exe-effort-KEY-Asc
              START tmp-exe-effort KEY > tee-key
           ELSE
              START tmp-exe-effort KEY < tee-key
           END-IF
           .

       DataSet1-tmp-exe-effort-START-LESS.
           IF DataSet1-tmp-exe-effort-KEY-Asc
              START tmp-exe-effort KEY < tee-key
           ELSE
              START tmp-exe-effort KEY > tee-key
           END-IF
           .

       DataSet1-tmp-exe-effort-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-exe-effort-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-exe-effort-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-exe-effort-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, BeforeWrite>
      * <TOTEM:END>
           WRITE tee-rec OF tmp-exe-effort.
           MOVE STATUS-tmp-exe-effort TO TOTEM-ERR-STAT
           MOVE "tmp-exe-effort" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-exe-effort-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmp-exe-effort TO TOTEM-ERR-STAT
           MOVE "tmp-exe-effort" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-exe-effort-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmp-exe-effort TO TOTEM-ERR-STAT
           MOVE "tmp-exe-effort" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-exe-effort, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-wodbook-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-wodbook-KEY1-Asc
                 MOVE Low-Value TO wod-key
              ELSE
                 MOVE High-Value TO wod-key
              END-IF
           END-EVALUATE
           .

       DataSet1-wodbook-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-wodbook-KEY1-Asc
                 MOVE High-Value TO wod-key
              ELSE
                 MOVE Low-Value TO wod-key
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-wodbook-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-wodbook-KEY1-ORDER
           END-EVALUATE
           .

      * wodbook
       DataSet1-wodbook-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-wodbook-KEY1-Asc
                 START wodbook KEY >= wod-key
              ELSE
                 START wodbook KEY <= wod-key
              END-IF
           END-EVALUATE
           .

       DataSet1-wodbook-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-wodbook-KEY1-Asc
                 START wodbook KEY <= wod-key
              ELSE
                 START wodbook KEY >= wod-key
              END-IF
           END-EVALUATE
           .

       DataSet1-wodbook-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-wodbook-KEY1-Asc
                 START wodbook KEY > wod-key
              ELSE
                 START wodbook KEY < wod-key
              END-IF
           END-EVALUATE
           .

       DataSet1-wodbook-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-wodbook-KEY1-Asc
                 START wodbook KEY < wod-key
              ELSE
                 START wodbook KEY > wod-key
              END-IF
           END-EVALUATE
           .

       DataSet1-wodbook-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-wodbook-LOCK
                 READ wodbook WITH LOCK 
                 KEY wod-key
              ELSE
                 READ wodbook WITH NO LOCK 
                 KEY wod-key
              END-IF
           END-EVALUATE
           MOVE STATUS-wodbook TO TOTEM-ERR-STAT 
           MOVE "wodbook" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-wodbook-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-wodbook-KEY1-Asc
                 IF DataSet1-wodbook-LOCK
                    READ wodbook NEXT WITH LOCK
                 ELSE
                    READ wodbook NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-wodbook-LOCK
                    READ wodbook PREVIOUS WITH LOCK
                 ELSE
                    READ wodbook PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-wodbook TO TOTEM-ERR-STAT
           MOVE "wodbook" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-wodbook-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-wodbook-KEY1-Asc
                 IF DataSet1-wodbook-LOCK
                    READ wodbook PREVIOUS WITH LOCK
                 ELSE
                    READ wodbook PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-wodbook-LOCK
                    READ wodbook NEXT WITH LOCK
                 ELSE
                    READ wodbook NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-wodbook TO TOTEM-ERR-STAT
           MOVE "wodbook" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-wodbook-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, BeforeWrite>
      * <TOTEM:END>
           WRITE wod-rec OF wodbook.
           MOVE STATUS-wodbook TO TOTEM-ERR-STAT
           MOVE "wodbook" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-wodbook-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, BeforeRewrite>
      * <TOTEM:END>
           REWRITE wod-rec OF wodbook.
           MOVE STATUS-wodbook TO TOTEM-ERR-STAT
           MOVE "wodbook" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-wodbook-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, BeforeDelete>
      * <TOTEM:END>
           DELETE wodbook.
           MOVE STATUS-wodbook TO TOTEM-ERR-STAT
           MOVE "wodbook" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:wodbook, AfterDelete>
      * <TOTEM:END>
           .

       wodmap-wom-k-desc-MERGE-SPLITBUF.
           INITIALIZE wodmap-wom-k-desc-SPLITBUF
           MOVE wom-desc(1:100) TO wodmap-wom-k-desc-SPLITBUF(1:100)
           .

       DataSet1-wodmap-INITSTART.
           IF DataSet1-wodmap-KEY-Asc
              MOVE Low-Value TO wom-key
           ELSE
              MOVE High-Value TO wom-key
           END-IF
           .

       DataSet1-wodmap-INITEND.
           IF DataSet1-wodmap-KEY-Asc
              MOVE High-Value TO wom-key
           ELSE
              MOVE Low-Value TO wom-key
           END-IF
           .

      * wodmap
       DataSet1-wodmap-START.
           IF DataSet1-wodmap-KEY-Asc
              START wodmap KEY >= wom-key
           ELSE
              START wodmap KEY <= wom-key
           END-IF
           .

       DataSet1-wodmap-START-NOTGREATER.
           IF DataSet1-wodmap-KEY-Asc
              START wodmap KEY <= wom-key
           ELSE
              START wodmap KEY >= wom-key
           END-IF
           .

       DataSet1-wodmap-START-GREATER.
           IF DataSet1-wodmap-KEY-Asc
              START wodmap KEY > wom-key
           ELSE
              START wodmap KEY < wom-key
           END-IF
           .

       DataSet1-wodmap-START-LESS.
           IF DataSet1-wodmap-KEY-Asc
              START wodmap KEY < wom-key
           ELSE
              START wodmap KEY > wom-key
           END-IF
           .

       DataSet1-wodmap-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-wodmap-LOCK
              READ wodmap WITH LOCK 
              KEY wom-key
           ELSE
              READ wodmap WITH NO LOCK 
              KEY wom-key
           END-IF
           PERFORM wodmap-wom-k-desc-MERGE-SPLITBUF
           MOVE STATUS-wodmap TO TOTEM-ERR-STAT 
           MOVE "wodmap" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-wodmap-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-wodmap-KEY-Asc
              IF DataSet1-wodmap-LOCK
                 READ wodmap NEXT WITH LOCK
              ELSE
                 READ wodmap NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-wodmap-LOCK
                 READ wodmap PREVIOUS WITH LOCK
              ELSE
                 READ wodmap PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM wodmap-wom-k-desc-MERGE-SPLITBUF
           MOVE STATUS-wodmap TO TOTEM-ERR-STAT
           MOVE "wodmap" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-wodmap-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-wodmap-KEY-Asc
              IF DataSet1-wodmap-LOCK
                 READ wodmap PREVIOUS WITH LOCK
              ELSE
                 READ wodmap PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-wodmap-LOCK
                 READ wodmap NEXT WITH LOCK
              ELSE
                 READ wodmap NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM wodmap-wom-k-desc-MERGE-SPLITBUF
           MOVE STATUS-wodmap TO TOTEM-ERR-STAT
           MOVE "wodmap" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-wodmap-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-wodmap TO TOTEM-ERR-STAT
           MOVE "wodmap" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-wodmap-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-wodmap TO TOTEM-ERR-STAT
           MOVE "wodmap" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-wodmap-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-wodmap TO TOTEM-ERR-STAT
           MOVE "wodmap" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:wodmap, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE exe-rec OF exercises
           INITIALIZE grp-rec OF groups
           INITIALIZE int-rec OF intensity
           INITIALIZE mcg-rec OF macrogroups
           INITIALIZE dur-rec OF duration
           INITIALIZE tee-rec OF tmp-exe-effort
           INITIALIZE wod-rec OF wodbook
           INITIALIZE wom-rec OF wodmap
           .


      * GRID
       gd1-Content.
      * CELLS' SETTING
              MODIFY gd1, X = 1, Y = 1,
                CELL-COLOR = 299,
                CELL-DATA = "Esercizio",
      * CELLS' SETTING
              MODIFY gd1, X = 2, Y = 1,
                CELL-COLOR = 299,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY gd1, X = 3, Y = 1,
                CELL-COLOR = 299,
                CELL-DATA = "Serie",
      * CELLS' SETTING
              MODIFY gd1, X = 4, Y = 1,
                CELL-COLOR = 299,
                CELL-DATA = "Reps",
           .

      * COMBO-BOX
       cb-mg1-Content.
           .

      * COMBO-BOX
       cb-mg2-Content.
           .

      * COMBO-BOX
       cb-mg3-Content.
           .

      * COMBO-BOX
       cb-mg4-Content.
           .

      * COMBO-BOX
       cb-mg5-Content.
           .

      * COMBO-BOX
       cb-mgtb-Content.
           .

      * COMBO-BOX
       cb-int-Content.
           .

      * COMBO-BOX
       cb-dur-Content.
           .

      * COMBO-BOX
       cb-rnd-Content.
           .

      * COMBO-BOX
       cb-gio-Content.
           .

      * COMBO-BOX
       cb-mul-Content.
           .

      * COMBO-BOX
       cb-wod-Content.
           .

      * COMBO-BOX
       cb-mg6-Content.
           .

      * FD's Initialize Paragraph
       DataSet1-exercises-INITREC.
           INITIALIZE exe-rec OF exercises
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-groups-INITREC.
           INITIALIZE grp-rec OF groups
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-intensity-INITREC.
           INITIALIZE int-rec OF intensity
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-macrogroups-INITREC.
           INITIALIZE mcg-rec OF macrogroups
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-duration-INITREC.
           INITIALIZE dur-rec OF duration
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-exe-effort-INITREC.
           INITIALIZE tee-rec OF tmp-exe-effort
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-wodbook-INITREC.
           INITIALIZE wod-rec OF wodbook
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-wodmap-INITREC.
           INITIALIZE wom-rec OF wodmap
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-DISPLAY-STATUS-MSG.
            MODIFY Form1-St-1-Handle PANEL-INDEX = 1
                PANEL-TEXT = TOTEM-HINT-TEXT
           .

       Form1-CLEAR-STATUS-MSG.
           MOVE SPACES TO TOTEM-MSG-1, TOTEM-MSG-2, TOTEM-MSG-3, 
           TOTEM-MSG-TEXT
           PERFORM Form1-DISPLAY-STATUS-MSG
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              SCREEN LINE 2,
              SCREEN COLUMN 2,
              LINES 27,00,
              SIZE 113,50,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 131329,
              CONTROL FONT Calibri14-Occidentale,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 3,35,   
              CONTROL FONT IS Calibri14-Occidentale
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY STATUS-BAR
              FONT IS Calibri14-Occidentale,
              GRIP,
              PANEL-WIDTHS (65, 28, 999),
              PANEL-STYLE  (1, 1, 1),
              PANEL-TEXT   (SPACE, SPACE, SPACE),
              HANDLE IS Form1-St-1-Handle
           DISPLAY Form1 UPON form1-Handle
      * DISPLAY-COLUMNS settings
              MODIFY gd1, DISPLAY-COLUMNS (1, 11, 41, 51)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           perform INIT.
           perform ABILITA-TOOLBAR.
           perform ABILITAZIONI.
           perform STATUS-BAR-MSG.
           display form1.
                                                  
           modify cb-mg1, item-to-add = "Nessuno".
           modify cb-mg2, item-to-add = "Nessuno".
           modify cb-mg3, item-to-add = "Nessuno".
           modify cb-mg4, item-to-add = "Nessuno". 
           modify cb-mg5, item-to-add = "Nessuno".
           modify cb-mg6, item-to-add = "Nessuno".
           modify cb-int, item-to-add = "Nessuno".
                                                 
           modify cb-mgtb, item-to-add = "No".
           modify cb-mgtb, item-to-add = "Si".   
                                             
           modify cb-rnd, item-to-add = "No".
           modify cb-rnd, item-to-add = "Si".
 
           modify cb-mul, item-to-add = "No".
           modify cb-mul, item-to-add = "Si".     
                                          
           modify cb-dur, item-to-add = "Nessuno".

           modify cb-gio, item-to-add = 1.
           modify cb-gio, item-to-add = 2.
           modify cb-gio, item-to-add = 3.
           modify cb-gio, item-to-add = 4.
           modify cb-gio, item-to-add = 5.
                        
           move low-value to wom-desc.
           start wodmap key >= wom-k-desc
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read wodmap next at end exit perform end-read
                    move wom-desc to cb-wod-buf          
                    modify cb-wod, item-to-add = wom-desc
                    modify cb-wod, value = wom-desc
                 end-perform
           end-start.
                        
           move low-value to mcg-desc.
           start macrogroups key >= mcg-k-desc
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read macrogroups next at end exit perform end-read

                    add 1 to tot-mcg 
                    move mcg-desc to el-mcg-desc(tot-mcg)

                    modify cb-mg1, item-to-add = mcg-desc
                    modify cb-mg2, item-to-add = mcg-desc
                    modify cb-mg3, item-to-add = mcg-desc
                    modify cb-mg4, item-to-add = mcg-desc
                    modify cb-mg5, item-to-add = mcg-desc
                    modify cb-mg6, item-to-add = mcg-desc
                 end-perform
           end-start.
           move low-value to int-key.
           start intensity key >= int-key
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read intensity next at end exit perform end-read
                    modify cb-int, item-to-add = int-desc
                 end-perform
           end-start.
           move low-value to dur-key.
           start duration key >= dur-key
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read duration next at end exit perform end-read
                    modify cb-dur, item-to-add = dur-desc
                 end-perform
           end-start.
           modify cb-mg1, value "Nessuno".
           modify cb-mg2, value "Nessuno".
           modify cb-mg3, value "Nessuno".
           modify cb-mg4, value "Nessuno".
           modify cb-mg5, value "Nessuno".
           modify cb-mg6, value "Nessuno".
           modify cb-int, value "Nessuno".
                        
           modify cb-mgtb, value "No".    
                                  
           modify cb-rnd,  value "No".    

           modify cb-mul,  value "Si".
                                         
           modify cb-dur, value "Nessuno".

           modify cb-gio, value 1.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
           evaluate key-status
           when 5 |MODIFICA
                inquire tool-modifica, enabled in e-modifica
                if e-modifica = 1
                   if mod = zero 
                      move 1    to mod
                   else          
                      move zero to mod
                   end-if
                   modify tool-modifica, value = mod
                   perform MODIFICA
                end-if
           end-evaluate.

           .
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM pb-genera-LinkTo
              WHEN Key-Status = 1001
                 PERFORM Screen1-Pb-1-LinkTo
              WHEN Key-Status = 1002
                 PERFORM pb-random-LinkTo
              WHEN Key-Status = 2
                 PERFORM NUOVO-LinkTo
              WHEN Key-Status = 4
                 PERFORM CANCELLA-LinkTo
              WHEN Key-Status = 3
                 PERFORM TOOL-SALVA-LinkTo
              WHEN Key-Status = 6
                 PERFORM ANTEPRIMA-LinkTo
              WHEN Key-Status = 150
                 PERFORM TOOL-MODIFICA-LinkTo
              WHEN Key-Status = 7
                 PERFORM STAMPA-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
              WHEN Key-Status = 9
                 PERFORM TOOL-SELEZIONA-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           perform SALV-MOD.

           if errori
              move 26 to key-status
              exit paragraph
           end-if.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd1-Content
      * COMBO-BOX
           PERFORM cb-mg1-Content
      * COMBO-BOX
           PERFORM cb-mg2-Content
      * COMBO-BOX
           PERFORM cb-mg3-Content
      * COMBO-BOX
           PERFORM cb-mg4-Content
      * COMBO-BOX
           PERFORM cb-mg5-Content
      * COMBO-BOX
           PERFORM cb-mgtb-Content
      * COMBO-BOX
           PERFORM cb-int-Content
      * COMBO-BOX
           PERFORM cb-dur-Content
      * COMBO-BOX
           PERFORM cb-rnd-Content
      * COMBO-BOX
           PERFORM cb-gio-Content
      * COMBO-BOX
           PERFORM cb-mul-Content
      * COMBO-BOX
           PERFORM cb-wod-Content
      * COMBO-BOX
           PERFORM cb-mg6-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-wodbook-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-wodbook-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE wod-rec OF wodbook TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     wod-rec OF wodbook
           PERFORM DataSet1-wodbook-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-wodbook-INITSTART
           PERFORM DataSet1-wodbook-START
           IF NOT Valid-STATUS-wodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-wodbook-Read-Next
           IF NOT Valid-STATUS-wodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-wodbook-START-LESS
           IF NOT Valid-STATUS-wodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-wodbook-Read-Prev
           IF NOT Valid-STATUS-wodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-wodbook-START-GREATER
           IF NOT Valid-STATUS-wodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-wodbook-Read-Next
           IF NOT Valid-STATUS-wodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-wodbook-INITEND
           PERFORM DataSet1-wodbook-START-NOTGREATER
           IF NOT Valid-STATUS-wodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-wodbook-Read-Prev
           IF NOT Valid-STATUS-wodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-wodbook-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-STATUS-wodbook
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-wodbook-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-wodbook-Rec-Write
           IF Valid-STATUS-wodbook
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-wodbook-START              
           IF NOT Valid-STATUS-wodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-wodbook-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-wodbook-Rec-Rewrite
           IF Valid-STATUS-wodbook
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-wodbook-Rec-Delete
           IF Valid-STATUS-wodbook
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-wodbook
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-STATUS-wodbook
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE titolo TO TOTEM-MSG-TITLE
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
           perform ABILITAZIONI. 
           perform VALORIZZA-OLD.

           .
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-wodbook-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE wod-rec OF wodbook TO 
              TMP-Form1-wodbook-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-wodbook-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-wodbook-RESTOREBUF TO
              wod-rec OF wodbook
           PERFORM DataSet1-wodbook-START
           IF Valid-STATUS-wodbook
              PERFORM DataSet1-wodbook-Read-Next
           ELSE
              PERFORM DataSet1-wodbook-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-wodbook OR
              (Valid-STATUS-wodbook AND
                 wod-rec OF wodbook = 
                   TMP-Form1-wodbook-RESTOREBUF)
              PERFORM DataSet1-wodbook-Read-Next
           END-PERFORM
           .



       Screen1-Event-Proc.
           .

       Screen1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5001 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 5001 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 5001 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-End-Drag
           WHEN Msg-Finish-Entry ALSO 5001 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Finish-Entry
           WHEN Msg-Goto-Cell ALSO 5001 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5001 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5001 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

      * USER DEFINE PARAGRAPH
       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "abilita-toolbar.cpy".
           copy "color-custom.cpy".
           copy "status.cpy".
           copy "utydata.cpy" 
           .
      * <TOTEM:END>

       ABILITAZIONI.
      * <TOTEM:PARA. ABILITAZIONI>
           if mod = 1              
              move BitmapDeleteEnabled to BitmapNumDelete
              move BitmapSaveEnabled   to BitmapNumSave
              move 1 to e-salva e-cancella
           else           
              move BitmapDeleteDisabled to BitmapNumDelete
              move BitmapSaveDisabled   to BitmapNumSave
              move 0 to e-salva e-cancella
           end-if.      


           modify tool-cancella, enabled = e-cancella.
           modify tool-salva,    enabled = e-salva.
       
      * ISACCO (SERVE SEMPRE PER LA MODIFICA PRCEDENTE E PER RIPRISTINARE
      * LE BITMAP DISABILITATE. - 10/11/2003
      *     perform FORM1-DISPLAY.
           display tool-nuovo, tool-salva, tool-cancella, tool-modifica.
      * FINE 
           .
      * <TOTEM:END>

       ANTEPRIMA.
      * <TOTEM:PARA. ANTEPRIMA>
           set s-anteprima to true.
           perform STAMPA-ANTEPRIMA 
           .
      * <TOTEM:END>

       CANCELLA.
      * <TOTEM:PARA. CANCELLA>
      *     if mod = 0 exit paragraph end-if.
      **
      *     display message MSG-Cancellare-il-record-corrente
      *             title   titolo
      *             type    mb-yes-no 
      *             default mb-no
      *             giving  scelta
      *
      *     if scelta = mb-yes
      *        perform RIEMPI-CHIAVE
      *        delete tschede record 
      *               invalid  continue
      *           not invalid  perform DELETE-RIGHE
      *        end-delete
      *
      *        move 0   to mod
      *        move 1   to mod-k
      *        perform FORM1-CLEAR
      *        set vecchio to true
      *        perform CANCELLA-COLORE
      *        perform INIT-OLD-REC
      *        perform RESETTA-GRID
      *        
      *        display message MSG-Cancellazione-avvenuta-con-successo
      *                title titolo                         
      *
      *        unlock tschede all records
      *
      *        move 78-ID-ef-cliente to control-id     
      *        move 4                to accept-control 
      *
      *        set Statusvisua to true
      *        perform STATUS-BAR-MSG
      *        modify TOOL-MODIFICA value = mod
      *     end-if 
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
      *     evaluate CONTROL-ID
      **
      *     when 78-ID-ef-cliente           
      *          set SceltoCliente to false
      *          inquire ef-cliente, value in cli-codice
      *          move "clienti-alfa" to como-file
      *          call "zoom-gt"   using como-file, cli-rec
      *                          giving stato-zoom
      *          cancel "zoom-gt"
      *          if stato-zoom = 0
      *             set SceltoCliente to true
      *             move cli-codice   to tsc-cliente
      *             modify ef-cliente, value tsc-cliente
      *             move 4                to ACCEPT-CONTROL   
      *          end-if
      *
      *     when 78-ID-gd1
      *          perform X-Y
      *          evaluate colonna
      *          when 78-col-art
      *               inquire gd1(riga, 78-col-art), 
      *                                         cell-data in art-codice
      *               move "articoli"     to Como-File
      *               call   "zoom-gt" using  como-file, art-rec
      *                                giving stato-zoom
      *               cancel "zoom-gt"
      *               if stato-zoom = 0
      *                  move art-codice        to col-art
      *                  move art-descrizione   to col-des
      *                  modify gd1(riga, 78-col-art), 
      *                         cell-data = col-art
      *                  modify gd1(riga, 78-col-des), 
      *                         cell-data = col-des
      *                  perform CONTROLLO-RIGA
      *               end-if
      *
      *          when 78-col-prz
      *               perform VALORE-RIGA
      *               move riga to store-riga
      *               perform FORM-PREZZI-OPEN-ROUTINE
      *               move store-riga to riga
      *               if prezzo-scelto not = 0
      *                  move prezzo-scelto to col-prz
      *                  modify gd1(riga, 78-col-prz), cell-data col-prz
      *                  if como-col-sc1 = 0 |and como-col-sc2 = 0
      *                     move cli-sconto1 to como-col-sc1 col-sc1
      ******                     move cli-sconto2 to como-col-sc2 col-sc2
      *                     modify gd1(riga, 78-col-sc1), cell-data col-sc1
      ******                     modify gd1(riga, 78-col-sc2), cell-data col-sc2
      *                  end-if
      *                  perform VALORE-RIGA
      *                  perform CALCOLA-NETTO
      *                  if col-prz not = old-col-prz
      *                     move riga        to RigaCambiata
      *                     move 78-col-prz  to ColonnaCambiata
      *                  end-if
      *               end-if
      *               move 78-ID-gd1 to control-id
      *               move 4         to accept-control
      *               modify gd1, cursor-y riga, cursor-x 78-col-prz
      *
      *          end-evaluate
      *     end-evaluate  
           .
      * <TOTEM:END>

       COLORE-RIGA.
      * <TOTEM:PARA. COLORE-RIGA>
           modify gd1, start-x = 1,
                             x = 78-max-colonne - 2,
                       start-y = riga,
                             y = riga,
                  region-color = 257,
                  cursor-color = colore-nu 
           .
      * <TOTEM:END>

       CLEAR-SCREEN.
      * <TOTEM:PARA. CLEAR-SCREEN>
      *     move tsc-chiave to old-tsc-chiave.
      *
      *     initialize tsc-dati of tschede 
      *               replacing numeric data by zeroes
      *                    alphanumeric data by spaces.
      *                   
      *     perform FORM1-FLD-TO-BUF. 
      *
      *     perform INIT-OLD-REC.
      *
      *     perform CLEAR-CLIENTE.
      *                                   
      *     display form1. 
      *
      *     perform RESETTA-GRID.
      *
      *     unlock tschede all records    
           .
      * <TOTEM:END>

       CHECK-INSERIMENTO.
      * <TOTEM:PARA. CHECK-INSERIMENTO>
      * MODIFICA LA STATUS-BAR
      * CONTROLLO SE DA INSERIMENTO SCORRO. ALLORA DEVO SEGNALARE CHE
      * SONO TORNATO IN MODIFICA.
           inquire tool-modifica, value in mod.

           evaluate mod
           when 1  
                set StatusModifica to true
           when 0
                set StatusVisua    to true   
           end-evaluate.
      
           perform STATUS-BAR-MSG 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
      *     set tutto-ok to true. 
      *
      *     evaluate CONTROL-ID
      *     when 78-ID-ef-cliente
      *          perform RIEMPI-CHIAVE           
      *          if ef-cliente-buf not = spaces
      *             read tschede no lock key tsc-k-cliente
      *                  invalid
      *                  if vecchio
      *                     display message MSG-record-inesistente
      *                               title tit-err
      *                                icon 2
      *                     perform CLEAR-SCREEN
      *                     set errori to true
      *                  else
      *                     perform DISPLAY-CLIENTE
      *                     display form1
      *                  end-if
      *              not invalid      
      *                  if old-tsc-chiave not = tsc-chiave or mod = 0
      *                     perform CURRENT-RECORD 
      *                  end-if
      *             end-read
      *
      *          else
      *             set errori to true  
      *             move 78-ID-ef-cliente to control-id
      *             display message box MSG-record-inesistente
      *                     title = tit-err
      *                     icon mb-warning-icon
      *          end-if
      *          if errori
      *             move 78-ID-ef-cliente to control-id
      *             move 4               to accept-control
      *          end-if
      *
      *     end-evaluate.
      *
      *     if errori
      *        perform CANCELLA-COLORE
      *        move CONTROL-ID to store-id
      *        move 4          to ACCEPT-CONTROL
      *     end-if 
           .
      * <TOTEM:END>

       CONTROLLO-RIGA.
      * <TOTEM:PARA. CONTROLLO-RIGA>
      *     set tutto-ok to true.
      *     if mod = 0 
      *        exit paragraph 
      *     end-if.
      *
      *     evaluate colonna
      *     when 78-col-data
      *          move como-col-data to como-data
      *          perform DATE-FORMAT
      *          move como-data to col-data
      *          modify gd1(riga, 78-col-data), cell-data col-data
      *     when 78-col-art
      *          move col-art to art-codice
      *          if art-codice not = spaces
      *             read articoli no lock
      *                  invalid
      *                  move spaces to art-descrizione
      *                  set errori to true
      *                  display message "Articolo NON valido"
      *                            title tit-err
      *                          icon 2
      *             end-read
      *             modify gd1(riga, 78-col-des), cell-data art-descrizione
      *          end-if
      *     when 78-col-des
      *          if col-art = spaces and col-des = spaces
      *             set errori to true
      *             display message "Articolo o Descrizione obbligatorio"
      *                       title tit-err
      *                        icon 2
      *          end-if
      *
      *     when 78-col-prz
      *          if como-col-prz = 0 and col-art not = spaces
      *             set errori to true
      *             display message "Prezzo obbligatorio"
      *                       title tit-err
      *                        icon 2
      *          end-if
      *          if tutto-ok
      *             perform CALCOLA-NETTO
      *          end-if
      *
      *     when 78-col-sc1
      ******     when 78-col-sc2
      *          perform CALCOLA-NETTO
      *     end-evaluate.
      *
      *
      ****** 78  78-col-qta        value 4. 
      ****** 78  78-col-prz        value 5. 
      ****** 78  78-col-sc         value 6. 
      ****** 78  78-col-note       value 8. 
      ****** 78  78-col-numdoc     value 9. 
      ****** 78  78-col-datadoc    value 10  
           .
      * <TOTEM:END>

       CREA-OCCURS-GRUPPI.
      * <TOTEM:PARA. CREA-OCCURS-GRUPPI>
           initialize tab-mgroups replacing numeric data by zeroes
                                       alphanumeric data by spaces.

           move 0 to idx-gruppi.
                        
           inquire cb-gio, value in cb-gio-buf.
           inquire cb-dur, value in dur-desc.
           read duration key dur-k-desc.
                                             
           inquire cb-mg1, value in mcg-desc.
           perform ADD-ELEM-GRUPPO.                                  
           inquire cb-mg2, value in mcg-desc.
           perform ADD-ELEM-GRUPPO.                                  
           inquire cb-mg3, value in mcg-desc.
           perform ADD-ELEM-GRUPPO.                                  
           inquire cb-mg4, value in mcg-desc.
           perform ADD-ELEM-GRUPPO.                                  
           inquire cb-mg5, value in mcg-desc.
           perform ADD-ELEM-GRUPPO.
           inquire cb-mg6, value in mcg-desc.
           perform ADD-ELEM-GRUPPO.

      ***---
       ADD-ELEM-GRUPPO.
           read macrogroups key  mcg-k-desc 
                invalid continue
            not invalid 
                add 1 to idx-gruppi                   
                move mcg-desc to el-mgroup(idx-gruppi)
                move mcg-code to el-mcg-code(idx-gruppi)
           end-read.
           move idx-gruppi to tot-gruppi 
           .
      * <TOTEM:END>

       CURRENT-RECORD.
      * <TOTEM:PARA. CURRENT-RECORD>
      *     perform RIEMPI-CHIAVE.
      *     set tutto-ok  to true.
      *     set ReadSecca to true.
      *     if nuovo move 0 to mod end-if.
      *
      *     if mod = 1
      *        read tschede lock key tsc-k-cliente
      *           invalid
      *              set errori to true 
      *        end-read
      *     else
      *        read tschede no lock key tsc-k-cliente
      *           invalid 
      *              set errori to true 
      *        end-read
      *     end-if.                    
      *     set ReadSecca to false.
      *
      *     if RecLocked
      *        set RecLocked to false
      *     else
      *        if tutto-ok
      *           perform CANCELLA-COLORE
      *           if nuovo
      *              move 0      to mod
      *              move 1      to mod-k
      *              move 78-ID-ef-cliente to control-id
      *              move 4                to accept-control
      *           else
      *              move 78-ID-gd1 to control-id
      *              move 4         to accept-control
      *           end-if   
      *           perform FORM1-IUD-DISPLAY
      *           set vecchio to true
      *           if mod = 1
      *              set StatusModifica to true
      *           else                         
      *              set StatusVisua    to true
      *           end-if
      *           perform STATUS-BAR-MSG 
      *           perform VALORIZZA-OLD
      *           perform RIEMPI-GRID
      *        else
      *           move 0 to mod
      *           move 1 to mod-k
      *           if vecchio
      *              perform CLEAR-SCREEN
      *              if YesMessage
      *                 move 78-ID-ef-cliente to CONTROL-ID
      *                 move 4                to accept-control
      *                 display message MSG-Record-inesistente
      *                           title tit-err
      *                            icon 2
      *              end-if
      *           end-if
      *        end-if
      *     end-if 
           .
      * <TOTEM:END>

       DELETE-RIGHE.
      * <TOTEM:PARA. DELETE-RIGHE>
      *     move low-value  to rsc-rec.
      *     move tsc-codice to rsc-codice.
      *     start rschede key >= rsc-chiave
      *           invalid continue
      *       not invalid
      *           perform until 1 = 2
      *              read rschede next at end exit perform end-read
      *              if rsc-codice not = tsc-codice
      *                 exit perform 
      *              end-if
      *              delete rschede record invalid continue end-delete
      *           end-perform
      *     end-start 
           .
      * <TOTEM:END>

       INIT.
      * <TOTEM:PARA. INIT>
           move 0 to StatusHelp.
           move 1 to mod-k.
           set StatusVisua    to true  
           .
      * <TOTEM:END>

       INIT-OLD-REC.
      * <TOTEM:PARA. INIT-OLD-REC>
      *     initialize old-tsc-rec replacing numeric data by zeroes
      *                                 alphanumeric data by spaces.
      *
      *     initialize old-rsc-rec replacing numeric data by zeroes
      *                                 alphanumeric data by spaces.
      *
      *     move tsc-cliente to old-tsc-cliente 
           .
      * <TOTEM:END>

       MODIFICA.
      * <TOTEM:PARA. MODIFICA>
      *     move 5 to key-status.
      *     inquire tool-modifica, value in mod.
      *     set tutto-ok to true.
      *
      *     if nuovo
      *        move 1   to mod                  
      *        modify tool-modifica, value mod
      *     else
      **  SE L'UTENTE E' ABILITATO PUO' MODIFICARE UN RECORD
      *        if mod = 1
      *           set YesMessage to true
      *           perform CURRENT-RECORD
      *           if tutto-ok
      *              move 0   to mod-k
      *              move 1   to mod
      *              set StatusModifica to true
      *              perform STATUS-BAR-MSG
      *           end-if
      *        else
      *           move 1 to mod
      *           perform SALV-MOD            
      *           move 0 to mod
      *           move 1 to mod-k
      *           if errori
      *              move 1 to mod
      *              move 0 to mod-k
      *           else                  
      *              set NoMessage to true
      *              perform CURRENT-RECORD
      *              set StatusVisua to true
      *              perform STATUS-BAR-MSG 
      *              unlock tschede all records
      *              move 78-ID-ef-cliente to control-id
      *           end-if
      *        end-if
      *
      *        display form1
      *        modify tool-modifica,  value mod
      *        perform CANCELLA-COLORE 
      *
      *        move 4 to ACCEPT-CONTROL
      *     end-if 
           .
      * <TOTEM:END>

       NUOVO.
      * <TOTEM:PARA. NUOVO>
      *     perform SALV-MOD.
      *
      *     if tutto-ok  
      *        move 78-ID-ef-cliente to control-id
      *        move 4                to accept-control
      *        set nuovo to true
      *        perform CERCA
      *        if SceltoCliente
      *           move 1                to mod mod-k
      *           modify tool-modifica,  value = mod
      *           perform CANCELLA-COLORE
      *           perform VALORIZZA-NUOVO
      *           perform INIT-OLD-REC
      *           set StatusIns to true
      *           perform STATUS-BAR-MSG  
      *           set nuovo to true
      *        else
      *           set vecchio to true
      *        end-if
      *     end-if 
           .
      * <TOTEM:END>

       PUNTA-CELLA.
      * <TOTEM:PARA. PUNTA-CELLA>
           move 78-ID-gd1    to control-id store-id.
           move 4            to accept-control.
           modify gd1,       cursor-y riga, 
                             cursor-x colonna.
           perform COLORE-RIGA 
           .
      * <TOTEM:END>

       RESETTA-GRID.
      * <TOTEM:PARA. RESETTA-GRID>
           modify gd1, reset-grid = 1.
           perform GD1-CONTENT.
           initialize rec-grid.
           modify gd1, insert-rows = 999 
           .
      * <TOTEM:END>

       RIEMPI-CHIAVE.
      * <TOTEM:PARA. RIEMPI-CHIAVE>
      *     inquire ef-cliente, value in ef-cliente-buf.
      *     move ef-cliente-buf to tsc-cliente 
           .
      * <TOTEM:END>

       RIEMPI-GRID.
      * <TOTEM:PARA. RIEMPI-GRID>
      *     move 0 to store-riga.
      *     modify gd1, mass-update = 1.
      *     perform RESETTA-GRID.
      *     move low-value  to rsc-rec.
      *     move tsc-codice to rsc-codice.
      *
      *     set tutto-ok   to true.
      *     start rschede key >= rsc-chiave
      *           invalid  set errori  to true
      *     end-start.
      *
      *     if tutto-ok
      *        move 2 to riga
      *        perform until 1 = 2
      *           read rschede next no lock 
      *              at end 
      *                 exit perform 
      *           end-read
      *           if rsc-codice not = tsc-codice
      *              exit perform
      *           end-if
      *           move rsc-data  to como-data
      *           perform DATE-TO-SCREEN
      *           move como-data to col-data
      *           move rsc-articolo to art-codice col-art
      *           if col-art = spaces 
      *              move rsc-descrizione to art-descrizione
      *           else
      *              read articoli no lock 
      *                invalid move "** NON TROVATO **" to art-descrizione
      *              end-read
      *           end-if
      *           move art-descrizione to col-des
      *           move rsc-qta         to col-qta
      *           move rsc-prz         to col-prz
      *           move rsc-sconto1     to col-sc1
      ******           move rsc-sconto2     to col-sc2
      *           move rsc-netto       to col-netto
      *           move rsc-note        to col-note
      *           move 0               to col-numdoc
      *           move 0               to col-datadoc
      *           move spaces          to hid-documento
      *           if rsc-numfat not = 0
      *              move rsc-numfat  to col-numdoc
      *              move rsc-datafat to como-data
      *              perform DATE-TO-SCREEN
      *              move como-data   to col-datadoc
      *              modify gd1(riga, 78-col-numdoc),  cell-color 481
      *              modify gd1(riga, 78-col-datadoc), cell-color 481
      *              set hid-fattura to true
      *           end-if
      *           if rsc-numcor not = 0
      *              move rsc-numcor  to col-numdoc
      *              move rsc-datacor to como-data
      *              perform DATE-TO-SCREEN
      *              move como-data   to col-datadoc
      *              modify gd1(riga, 78-col-numdoc),  cell-color 193
      *              modify gd1(riga, 78-col-datadoc), cell-color 193
      *              set hid-corrisp to true
      *           end-if
      *           if rsc-numcor      = 0 and 
      *              rsc-numfat      = 0 and 
      *              num-doc     not = 0 and
      *              store-riga      = 0
      *              move riga to store-riga
      *           end-if
      *           modify gd1(riga, 78-col-data),    cell-data col-data
      *           modify gd1(riga, 78-col-art),     cell-data col-art
      *           modify gd1(riga, 78-col-des),     cell-data col-des
      *           modify gd1(riga, 78-col-qta),     cell-data col-qta
      *           modify gd1(riga, 78-col-prz),     cell-data col-prz
      *           modify gd1(riga, 78-col-sc1),     cell-data col-sc1
      ******           modify gd1(riga, 78-col-sc2),     cell-data col-sc2
      *           modify gd1(riga, 78-col-netto),   cell-data col-netto
      *           modify gd1(riga, 78-col-note),    cell-data col-note
      *           modify gd1(riga, 78-col-numdoc),  cell-data col-numdoc
      *           modify gd1(riga, 78-col-datadoc), cell-data col-datadoc
      *           modify gd1(riga, 1), hidden-data gruppo-hidden
      *           add 1 to riga
      *        end-perform
      *        subtract 2 from riga giving RigheIniziali
      *     end-if.
      *     modify gd1, mass-update = 0.
      *     if store-riga = 0
      *        move 2 to store-riga
      *     end-if.
      *     move store-riga to riga.
      *     move 1          to colonna.
      *     perform PUNTA-CELLA.
      *     perform VALORE-RIGA.
      *     move rsc-rec      to old-rsc-rec.
      *     move rsc-data     to como-old-rsc-data.
      *     move rsc-articolo to como-old-rsc-articolo 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
      *     if mod = 0 
      *        exit paragraph 
      *     end-if.
      *
      *     set tutto-ok to true.
      *
      *     set controllo-finale to true.
      *     perform varying control-id from 78-ID-ef-cliente by 1
      *               until control-id > 78-ID-ef-cliente
      *        perform CONTROLLO
      *        if errori 
      *           exit perform
      *        end-if
      *     end-perform.
      *
      *     if tutto-ok
      *        perform X-Y
      *        if tot-righe = 1
      *           set errori to true
      *           display message "Nessun articolo inserito"
      *                     title tit-err
      *                      icon 2
      *           move 78-ID-gd1 to control-id
      *           move 1 to colonna
      *        else
      *           perform VALORE-RIGA
      *           if not RigaVuota
      *              perform varying colonna from 78-col-data by 1
      *                        until colonna > 78-max-colonne|78-col-tipo-imp
      *                 perform CONTROLLO-RIGA
      *                 if errori exit perform end-if
      *              end-perform
      *           end-if
      *        end-if
      *     end-if.
      *            
      *     set controllo-finale to false.
      *
      *     if errori
      *        perform ABILITAZIONI
      *        if store-id = 78-ID-gd1
      *           perform CANCELLA-COLORE
      *           perform PUNTA-CELLA
      *        else
      *           move store-id to control-id
      *           move 4        to accept-control
      *        end-if
      *     else
      *
      *        if nuovo
      *           move high-value to      tsc-codice
      *           start tschede key <=    tsc-codice
      *                 invalid move 1 to tsc-codice
      *             not invalid
      *                 read tschede previous with no lock
      *                      at end move 1 to tsc-codice
      *                  not at end add  1 to tsc-codice
      *                 end-read
      *           end-start
      *           accept tsc-data-creazione from century-date
      *        end-if
      *
      *        perform DELETE-RIGHE
      *        perform FORM1-BUF-TO-FLD
      *        perform varying riga from 2 by 1 
      *                  until riga > tot-righe
      *           perform VALORE-RIGA
      *           perform SCRIVI-RIGA
      *        end-perform
      *
      *        perform CANCELLA-COLORE
      *        write tsc-rec invalid rewrite tsc-rec end-write 
      *
      *        if nuovo
      *           set vecchio to true
      *           perform STAMPA
      *        end-if
      *
      *        set vecchio      to true
      *        set stampa       to true
      *
      *        perform TORNA-IN-VISUA
      *        perform VALORIZZA-OLD
      *
      *     end-if.
      *
      *     display form1 
           .
      * <TOTEM:END>

       SALV-MOD.
      * <TOTEM:PARA. SALV-MOD>
      *     set tutto-ok to true.
      *     perform FORM1-CONTROLLO-OLD.
      *
      *     if SiSalvato and mod = 1
      *        if RigaCambiata not = 0 or ColonnaCambiata not = 0
      *           set NoSalvato  to true
      *           move 78-ID-gd1 to store-id
      *           move ColonnaCambiata to colonna
      *           move RigaCambiata    to riga
      *        end-if
      *     end-if.    
      *
      *     if SiSalvato and mod = 1
      *        inquire gd1, last-row in tot-righe
      *        subtract 1 from tot-righe
      *        if tot-righe not = RigheIniziali |or inserito-extra
      *           move tot-righe to riga
      *           set NoSalvato  to true
      *           move 78-ID-gd1 to store-id
      *           move 1 to colonna
      *        end-if
      *     end-if.
      *
      *     if NoSalvato
      *        display message MSG-Salvare-le-modifiche
      *                  title titolo
      *                   type mb-yes-no-cancel 
      *                 giving scelta       
      * 
      *        evaluate scelta
      *        when mb-yes 
      *             perform SALVA
      *        when mb-no  
      *             continue
      *             if nuovo
      *                perform RIEMPI-CHIAVE
      *                delete tschede record invalid continue end-delete
      *             end-if
      *        when other                
      *             perform CANCELLA-COLORE
      *             set errori to true
      *             evaluate store-id
      *             when 78-ID-gd1     
      *                  perform PUNTA-CELLA
      *             when other
      *                move store-id to control-id       
      *                move 4        to accept-control   
      *             end-evaluate
      *        end-evaluate
      *     end-if 
           .
      * <TOTEM:END>

       SCRIVI-RIGA.
      * <TOTEM:PARA. SCRIVI-RIGA>
      *     if como-col-data = 0
      *        exit paragraph
      *     end-if.
      *     initialize rsc-rec replacing numeric data by zeroes
      *                             alphanumeric data by spaces.
      *     move 1           to rsc-riga
      *     move tsc-codice  to rsc-codice.
      *     move como-col-data to como-data.
      *     perform DATE-TO-FILE.
      *     move como-data   to rsc-data.
      *     move col-art     to rsc-articolo.
      *
      *     move tsc-cliente to rsc-cliente.
      *     move col-des     to rsc-descrizione.
      *     move col-qta     to rsc-qta.
      *     move col-prz     to rsc-prz.
      *     move col-sc1     to rsc-sconto1.
      ******     move col-sc2     to rsc-sconto2.
      *     move col-netto   to rsc-netto.
      *     move col-note    to rsc-note.
      *     if como-col-numdoc not = 0
      *        if Hid-Fattura
      *           move col-numdoc  to rsc-numfat
      *           move col-datadoc to como-data
      *           perform DATE-TO-FILE
      *           move como-data   to rsc-datafat
      *        else
      *           move col-numdoc  to rsc-numcor
      *           move col-datadoc to como-data
      *           perform DATE-TO-FILE
      *           move como-data   to rsc-datacor
      *        end-if
      *     end-if.
      *     
      *     perform until 1 = 2
      *        write rsc-rec 
      *              invalid add 1 to rsc-riga
      *          not invalid exit perform
      *        end-write
      *     end-perform 
           .
      * <TOTEM:END>

       SELEZIONA.
      * <TOTEM:PARA. SELEZIONA>
      *     inquire ef-cliente, value in tsc-cliente.
      *     move "tschede"     to Como-File
      *     call   "zoom-gt" using  como-file, tsc-rec
      *                      giving stato-zoom
      *     cancel "zoom-gt"
      *     if stato-zoom = 0
      *        if old-tsc-chiave not = tsc-chiave or
      *         ( tsc-codice = 0 and mod = 0 )
      *           move tsc-cliente to save-cliente
      *           perform SALV-MOD
      *           if tutto-ok
      *              move save-cliente to tsc-cliente
      *              set ReadSecca to true
      *              modify ef-cliente, value tsc-cliente
      *              perform CURRENT-RECORD
      *              perform CANCELLA-COLORE
      *              move 78-ID-ef-cliente to CONTROL-ID       
      *              move 4                to ACCEPT-CONTROL   
      *           end-if                                  
      *        end-if
      *     end-if.
      *
      ******     set tutto-ok to true.
      ******     move zero   to link-fornitore
      ******     perform SEL-LISTINI.
      ******
      *********---
      ****** SEL-LISTINI.
      ******     call   "sel-listini" using link-codice 
      ******                                link-articolo 
      ******                                link-fornitore.
      ******     cancel "sel-listini".
      ******
      ******     if link-codice not = 0
      ******
      ******        if link-codice not = tsc-codice of tschede
      ******           perform SALV-MOD
      ******        end-if
      ******
      ******        if tutto-ok
      ******           set  ReadSecca   to true
      ******           move link-codice to tsc-codice of tschede 
      ******           move link-codice to ef-codice-buf
      ******           display ef-codice
      ******           perform CURRENT-RECORD
      ******           if link-articolo = 0
      ******              move 2 to riga
      ******           else
      ******              move store-riga to riga
      ******           end-if
      ******           move 1 to colonna
      ******           perform PUNTA-CELLA
      ******           perform CANCELLA-COLORE
      ******           if link-articolo = 0
      ******              move 78-ID-ef-codice to control-id
      ******              move 4               to accept-control
      ******           end-if
      ******        end-if
      ******
      ******     end-if.
      ******
      ******
      *********---
      ****** SELEZIONA-NUMERICO.
      ******     if tsc-codice of tschede not > 0
      ******        set errori to true
      ******        move 78-ID-ef-codice to control-id
      ******        display message box msg-codice-obbligatorio
      ******                title tit-err
      ******                icon  mb-warning-icon
      ******     else           
      ******        read tschede no lock
      ******             invalid
      ******             if vecchio
      ******                display message MSG-record-inesistente
      ******                          title tit-err
      ******                           icon 2
      ******                perform CLEAR-SCREEN
      ******                set errori to true
      ******             end-if
      ******         not invalid      
      ******             if old-tsc-chiave not = tsc-chiave of tschede or
      ******              ( tsc-codice of tschede = 0 and mod = 0 )
      ******                perform CURRENT-RECORD 
      ******             end-if
      ******        end-read
      ******     end-if.
      ******
      *********---
      ****** SELEZIONA-ALFA.
      ******* LA SECONDA CHIAVE E' ALFANUMERICA E LA VALUE VARIABLE CONTIENE
      ******* ANCORA GLI ZERI DAVANTI CHE ELIMINO
      ******     inspect ef-codice-buf replacing leading ZERO by SPACES.
      ******     move ef-codice-buf to cli-ragsoc-1.
      ******
      ******
      ******* POI GIUSTIFICO A SINISTRA E MI POSIZIONO SULLO ZOOM PER CHIAVE
      ******* ALTERNATA
      ******     call "C$JUSTIFY" using cli-ragsoc-1, "L".
      ******     move low-value to cli-codice
      ******                  
      ******     set cli-tipo-F to true.
      ******     start clienti key not < cli-k1
      ******        invalid 
      ******           initialize cli-rec
      ******        not invalid 
      ******           read clienti next 
      ******              if cli-tipo-C
      ******                 initialize cli-rec
      ******              end-if
      ******     end-start.
      ******     set cli-tipo-F to true.
      ******
      ******     if cli-ragsoc-1 = ef-codice-buf
      ******        move cli-codice   to link-fornitore
      ******        perform SEL-LISTINI
      ******     else
      ******        move "clienti-alfa-all" to como-file
      ******        call "zoom-gt"  using  como-file, cli-rec
      ******                        giving  stato-zoom
      ******        cancel "zoom-gt"
      ******        if stato-zoom = 0
      ******           move cli-codice    to link-fornitore
      ******           perform SEL-LISTINI
      ******        end-if
      *******     else
      *******        set errori           to true
      *******        move 78-ID-ef-codice to CONTROL-ID
      ******     end-if.
      ******
      *
      *
      * 
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
      *     set tutto-ok to true.
      *     perform X-Y.
      *
      *     if event-data-2 not = riga
      *
      *        perform VALORE-RIGA
      *
      *        if not RigaVuota
      *           perform varying colonna from 78-col-data by 1
      *                     until colonna > 78-max-colonne|78-col-tipo-imp
      *              perform CONTROLLO-RIGA
      *              if errori exit perform end-if
      *           end-perform
      *        end-if
      *
      ******        if tutto-ok and mod = 1
      ******           perform SCRIVI-RIGA
      ******        end-if
      *
      *        if tutto-ok
      *           evaluate true
      *           when event-data-2 < 2 
      *                move 2            to riga
      *                move event-data-1 to colonna
      *
      *           when event-data-2 > tot-righe
      *                add  1                to tot-righe giving riga
      *                set event-action      to event-action-fail
      *                move 1                to colonna
      *                perform PUNTA-CELLA
      *           when other
      *                move event-data-2 to riga
      *                move event-data-1 to colonna
      *           end-evaluate
      *           perform VALORE-RIGA
      *           if art-codice = 0
      *              initialize rsc-rec 
      *                         replacing numeric data by zeroes
      *                              alphanumeric data by spaces
      *           end-if
      *           move rsc-rec       to old-rsc-rec
      *           move rsc-data      to como-old-rsc-data
      *           move rsc-articolo  to como-old-rsc-articolo
      *        else                  
      *           set event-action   to event-action-fail
      *           perform PUNTA-CELLA
      *        end-if
      *     else
      *        if event-data-1 not = colonna
      *           inquire gd1(riga, 1), cell-data in art-codice
      *           if art-codice = 0
      *              set event-action to event-action-fail
      *              move 1 to colonna event-data-1
      *              perform PUNTA-CELLA
      *           end-if
      *        end-if
      *        move event-data-1 to colonna
      *     end-if.
      *
      *     perform COLORE-RIGA.
      *     move 0 to StatusHelp.
      *     if mod = 1 and como-col-data not = 0
      *        if colonna = 78-col-art
      *           move 1 to StatusHelp
      *        end-if
      *        if colonna = 78-col-prz and col-art not = spaces
      *           move 1 to StatusHelp
      *        end-if
      *     end-if.
      *     perform STATUS-HELP 
           .
      * <TOTEM:END>

       STAMPA.
      * <TOTEM:PARA. STAMPA>
           set s-stampa to true.
           perform STAMPA-ANTEPRIMA 
           .
      * <TOTEM:END>

       STAMPA-ANTEPRIMA.
      * <TOTEM:PARA. STAMPA-ANTEPRIMA>
      *     if nuovo
      *        display message "Salvare prima la scheda"
      *                  title tit-err
      *                   icon 2
      *     else
      *        if s-anteprima
      *           accept link-stampante from environment "STAMPANTE_ANTEPRIMA"
      *        else
      *           move spaces to link-stampante
      *        end-if
      *        call   "st-schedacli" using tsc-codice, link-stampante
      *        cancel "st-schedacli"
      *     end-if 
           .
      * <TOTEM:END>

       TORNA-IN-VISUA.
      * <TOTEM:PARA. TORNA-IN-VISUA>
      *     move 0 to mod.
      *     move 1 to mod-k.
      *     move 78-ID-ef-cliente to CONTROL-ID.
      *     set NoMessage to true.
      *     perform ABILITAZIONI.
      *     set StatusVisua to true.
      *     perform STATUS-BAR-MSG.
      *     unlock tschede all records.
      *                  
      *     modify tool-modifica,  value mod.
      *     perform CANCELLA-COLORE.
      *     move 4 to ACCEPT-CONTROL 
           .
      * <TOTEM:END>

       VALORE-RIGA.
      * <TOTEM:PARA. VALORE-RIGA>
      *     inquire gd1(riga, 78-col-data),    cell-data col-data.
      *     inquire gd1(riga, 78-col-art),     cell-data col-art. 
      *     inquire gd1(riga, 78-col-des),     cell-data col-des.
      *     inquire gd1(riga, 78-col-qta),     cell-data col-qta.
      *     inquire gd1(riga, 78-col-prz),     cell-data col-prz.
      *     inquire gd1(riga, 78-col-sc1),     cell-data col-sc1.
      ******     inquire gd1(riga, 78-col-sc2),     cell-data col-sc2.
      *     inquire gd1(riga, 78-col-netto),   cell-data col-netto.
      *     inquire gd1(riga, 78-col-note),    cell-data col-note.
      *     inquire gd1(riga, 78-col-numdoc),  cell-data col-numdoc.
      *     inquire gd1(riga, 78-col-datadoc), cell-data col-datadoc.
      *     inquire gd1(riga, 1), hidden-data gruppo-hidden.
      *
      *     move col-data    to como-col-data.
      *     move col-qta     to como-col-qta.
      *     move col-prz     to como-col-prz.
      *     move col-sc1     to como-col-sc1.
      ******     move col-sc2     to como-col-sc2.
      *     move col-netto   to como-col-netto.
      *     move col-numdoc  to como-col-numdoc.
      *     move col-datadoc to como-col-datadoc.
      *
      *     if como-col-data    = 0 and
      *        col-art          = spaces and
      *        col-des          = spaces and
      *        como-col-qta     = 0 and
      *        como-col-prz     = 0 and
      *        como-col-sc1     = 0 and
      ******        como-col-sc2     = 0 and
      *        como-col-netto   = 0 and
      *        col-note         = spaces and
      *        como-col-numdoc  = 0 and
      *        como-col-datadoc = 0
      *        set RigaVuota to true
      *     else
      *        set RigaVuota to false
      *     end-if 
           .
      * <TOTEM:END>

       VALORIZZA-OLD.
      * <TOTEM:PARA. VALORIZZA-OLD>
      *     move tsc-rec to old-tsc-rec.
      *
      *     set vecchio to true.
      *
      *     move 0 to StatusHelp
      *     perform STATUS-HELP.
      *
      *     inquire gd1, last-row in tot-righe.
      *     move 0 to RigaCambiata ColonnaCambiata 
           .
      * <TOTEM:END>

       VALORIZZA-NUOVO.
      * <TOTEM:PARA. VALORIZZA-NUOVO>
      *     move "00"       to status-tschede.
      *     move cli-codice to tsc-cliente.
      *     perform FORM1-IUD-DISPLAY.
      *     display form1.
      *
      *     perform RESETTA-GRID.
      *
      *     move 0 to RigheIniziali.
      *     move 0 to RigaCambiata ColonnaCambiata 
           .
      * <TOTEM:END>

       X-Y.
      * <TOTEM:PARA. X-Y>
           inquire gd1, cursor-y in riga,
                        cursor-x in colonna,
                        last-row in tot-righe 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       NUOVO-LinkTo.
      * <TOTEM:PARA. NUOVO-LinkTo>
           INQUIRE TOOL-NUOVO, ENABLED IN E-NUOVO.

           IF E-NUOVO = 1
              PERFORM NUOVO
           END-IF                    
           .
      * <TOTEM:END>
       CANCELLA-LinkTo.
      * <TOTEM:PARA. CANCELLA-LinkTo>
           INQUIRE TOOL-MODIFICA, VALUE IN MOD.
                              
           INQUIRE TOOL-CANCELLA, ENABLED IN E-CANCELLA
           IF E-CANCELLA = 1
              PERFORM CANCELLA
           END-IF                                                
           .
      * <TOTEM:END>
       TOOL-SALVA-LinkTo.
      * <TOTEM:PARA. TOOL-SALVA-LinkTo>
           INQUIRE TOOL-MODIFICA, VALUE IN MOD           

           INQUIRE TOOL-SALVA, ENABLED IN E-SALVA
           IF E-SALVA = 1
              PERFORM SALVA
           END-IF           
           .
      * <TOTEM:END>
       ANTEPRIMA-LinkTo.
      * <TOTEM:PARA. ANTEPRIMA-LinkTo>
           INQUIRE TOOL-ANTEPRIMA, ENABLED IN E-ANTEPRIMA.
           IF E-ANTEPRIMA = 1
              PERFORM ANTEPRIMA
           END-IF 
           .
      * <TOTEM:END>
       TOOL-MODIFICA-BeforeProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       TOOL-MODIFICA-AfterProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       TOOL-MODIFICA-LinkTo.
      * <TOTEM:PARA. TOOL-MODIFICA-LinkTo>
           INQUIRE TOOL-MODIFICA, ENABLED IN E-MODIFICA.

           IF E-MODIFICA = 1
              PERFORM MODIFICA
           END-IF 
           .
      * <TOTEM:END>
       STAMPA-LinkTo.
      * <TOTEM:PARA. STAMPA-LinkTo>
           INQUIRE TOOL-STAMPA, ENABLED IN E-STAMPA
           IF E-STAMPA = 1
              PERFORM STAMPA
           END-IF 
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca
           if e-cerca = 1
              perform CERCA
           end-if 
           .
      * <TOTEM:END>
       TOOL-SELEZIONA-LinkTo.
      * <TOTEM:PARA. TOOL-SELEZIONA-LinkTo>
           inquire tool-seleziona, enabled in e-seleziona
           if e-seleziona = 1
              perform SELEZIONA
           end-if 
           .
      * <TOTEM:END>
       ginqui-Ev-Before-Program.
      * <TOTEM:PARA. ginqui-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID 
           .
      * <TOTEM:END>
       ginqui-Ev-After-Program.
      * <TOTEM:PARA. ginqui-Ev-After-Program>
           set environment "KEYSTROKE" to "DATA=44 44".
           set environment "KEYSTROKE" to "DATA=46 46".
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd1-Ev-Msg-Begin-Entry>
      *     if mod = 0                       
      *        set  event-action to event-action-fail-terminate
      *        inquire gd1(riga, 78-col-numdoc),  cell-data OLD-col-numdoc
      *        inquire gd1(riga, 78-col-datadoc), cell-data OLD-col-datadoc
      *
      *        move OLD-col-numdoc to como-col-numdoc
      *        if como-col-numdoc not = 0
      *           if colonna >= 78-col-numdoc
      *              inquire gd1, entry-reason in como-x
      *              evaluate como-x
      *              when X"00"|doppio click
      *              when X"0D"|invio
      ******                   move OLD-col-numdoc  to tfa-numero
      ******                   move OLD-col-datadoc to como-data
      ******                   perform DATE-TO-FILE
      ******                   move como-data(1:4)  to tfa-numero
      *                   set VediFattura to true
      *              end-evaluate
      *           end-if
      *        end-if
      *     else
      *        perform X-Y
      *        inquire gd1(riga, 78-col-data), cell-data OLD-col-data
      *        move OLD-col-data to como-data
      *        inquire gd1(riga, 78-col-art),  cell-data OLD-col-art
      *
      *        if como-col-data = 0 and colonna not = 78-col-data
      *           set event-action to event-action-fail
      *        end-if
      *
      *        inquire gd1(riga, 78-col-des),     cell-data OLD-col-des
      *        inquire gd1(riga, 78-col-qta),     cell-data OLD-col-qta
      *        inquire gd1(riga, 78-col-sc1),     cell-data OLD-col-sc1
      ******        inquire gd1(riga, 78-col-sc2),     cell-data OLD-col-sc2
      *        inquire gd1(riga, 78-col-netto),   cell-data OLD-col-netto
      *        inquire gd1(riga, 78-col-note),    cell-data OLD-col-note
      *        inquire gd1(riga, 78-col-numdoc),  cell-data OLD-col-numdoc
      *        inquire gd1(riga, 78-col-datadoc), cell-data OLD-col-datadoc
      *
      *        move OLD-col-numdoc to como-col-numdoc
      *        if como-col-numdoc not = 0
      *           if colonna >= 78-col-numdoc
      *              set  event-action to event-action-fail-terminate
      *              inquire gd1, entry-reason in como-x
      *              evaluate como-x
      *              when X"00"|doppio click
      *              when X"0D"|invio
      ******                   move OLD-col-numdoc  to tfa-numero
      ******                   move OLD-col-datadoc to como-data
      ******                   perform DATE-TO-FILE
      ******                   move como-data(1:4)  to tfa-numero
      *                   set VediFattura to true
      *              end-evaluate
      *           else
      *              set event-action to event-action-fail
      *           end-if
      *        else
      *           evaluate colonna
      *           when 78-col-data
      *           when 78-col-art
      *                continue
      *           when 78-col-des
      *                if col-art = spaces
      *                   continue
      *                else
      *                   set event-action to event-action-fail 
      *                end-if
      *           when 78-col-netto
      *           when 78-col-numdoc
      *           when 78-col-datadoc
      *                set event-action to event-action-fail 
      *           when 78-col-qta 
      *           when 78-col-note
      *                continue
      *           when other
      *                set environment "KEYSTROKE" to "DATA=44 46"    
      *           end-evaluate
      *        end-if
      *
      *     end-if 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Finish-Entry.
      * <TOTEM:PARA. gd1-Ev-Msg-Finish-Entry>
      *     set tutto-ok to true.
      *     perform X-Y.
      *     perform VALORE-RIGA.
      *
      *     evaluate colonna
      *     when 78-col-data
      *          if como-col-data = 0
      *             if not RigaVuota
      *                display message "Cancellare la riga?"
      *                          title titolo
      *                           type mb-yes-no
      *                        default mb-no
      *                         giving scelta
      *                if scelta = mb-no
      *                   set errori to true
      *                else
      *                   initialize rec-grid 
      *                              replacing numeric data by zeroes
      *                                   alphanumeric data by spaces
      *
      *                   move riga to store-riga
      *                   add 1 to riga
      *                   perform VALORE-RIGA
      *                   move rsc-rec to old-rsc-rec
      *                   move store-riga to riga
      *           
      *                   modify gd1, record-to-delete = riga
      *                   modify gd1, insert-rows = 1
      *                end-if
      *             end-if
      *          else
      *             perform CONTROLLO-RIGA
      *          end-if
      *          if tutto-ok
      *             if rsc-data not = old-rsc-data
      *                move riga to RigaCambiata
      *                move 1    to ColonnaCambiata
      *             end-if
      *          end-if
      *
      *     when 78-col-art
      *          perform CONTROLLO-RIGA
      *          if tutto-ok
      *             if col-art not = old-col-art
      *                move riga        to RigaCambiata
      *                move 78-col-art  to ColonnaCambiata
      *             end-if
      *          end-if
      *
      *     when 78-col-des
      *          if col-des not = old-col-des
      *             move riga        to RigaCambiata
      *             move 78-col-des  to ColonnaCambiata
      *          end-if
      *
      *     when 78-col-qta
      *          if col-qta not = old-col-qta
      *             move riga        to RigaCambiata
      *             move 78-col-qta  to ColonnaCambiata
      *          end-if
      *
      *     when 78-col-prz 
      *          if como-col-prz not = 0
      *             if como-col-sc1 = 0 |and como-col-sc2 = 0
      *                move cli-sconto1 to como-col-sc1 col-sc1
      ******                move cli-sconto2 to como-col-sc2 col-sc2
      *                modify gd1(riga, 78-col-sc1), cell-data col-sc1
      ******                modify gd1(riga, 78-col-sc2), cell-data col-sc2
      *             end-if
      *          end-if
      *          perform CONTROLLO-RIGA
      *          if tutto-ok
      *             if col-prz not = old-col-prz
      *                move riga        to RigaCambiata
      *                move 78-col-prz  to ColonnaCambiata
      *             end-if
      *          end-if
      *
      *     when 78-col-sc1
      *          perform CONTROLLO-RIGA
      *          if col-sc1 not = old-col-sc1
      *             move riga        to RigaCambiata
      *             move 78-col-sc1  to ColonnaCambiata
      *          end-if
      *
      ******     when 78-col-sc2
      ******          perform CONTROLLO-RIGA
      ******          if col-sc1 not = old-col-sc1
      ******             move riga        to RigaCambiata
      ******             move 78-col-sc2  to ColonnaCambiata
      ******          end-if
      *
      *     when 78-col-note
      *          if col-note not = old-col-note
      *             move riga        to RigaCambiata
      *             move 78-col-note to ColonnaCambiata
      *          end-if 
      *     end-evaluate.
      *
      *     if errori
      *        move 78-ID-gd1 to store-id
      *        set event-action to event-action-fail
      *     else                                              
      *        modify gd1(riga, 78-col-qta),   cell-data col-qta
      *        modify gd1(riga, 78-col-prz),   cell-data col-prz
      *        modify gd1(riga, 78-col-sc1),   cell-data col-sc1
      ******        modify gd1(riga, 78-col-sc2),   cell-data col-sc2
      *        modify gd1(riga, 78-col-netto), cell-data col-netto
      *        set environment "KEYSTROKE" to "DATA=44 44"
      *        set environment "KEYSTROKE" to "DATA=46 46"
      *     end-if 
           .
      * <TOTEM:END>
       cb-mgtb-BeforeProcedure.
      * <TOTEM:PARA. cb-mgtb-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cb-mgtb-AfterProcedure.
      * <TOTEM:PARA. cb-mgtb-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           inquire cb-mgtb, value in cb-mgtb-buf.
           if cb-mgtb-buf = "Si"                             
              modify cb-mg1, value "Nessuno", enabled = false
              modify cb-mg2, value "Nessuno", enabled = false
              modify cb-mg3, value "Nessuno", enabled = false
              modify cb-mg4, value "Nessuno", enabled = false
              modify cb-mg5, value "Nessuno", enabled = false
              modify cb-mg6, value "Nessuno", enabled = false
           else                                              
              modify cb-mg1, enabled = true
              modify cb-mg2, enabled = true
              modify cb-mg3, enabled = true
              modify cb-mg4, enabled = true
              modify cb-mg5, enabled = true
              modify cb-mg6, enabled = true
           end-if 
           .
      * <TOTEM:END>
       cb-mg1-BeforeProcedure.
      * <TOTEM:PARA. cb-mg1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cb-mg2-BeforeProcedure.
      * <TOTEM:PARA. cb-mg2-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cb-mg3-BeforeProcedure.
      * <TOTEM:PARA. cb-mg3-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cb-mg4-BeforeProcedure.
      * <TOTEM:PARA. cb-mg4-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cb-mg5-BeforeProcedure.
      * <TOTEM:PARA. cb-mg5-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cb-mg1-AfterProcedure.
      * <TOTEM:PARA. cb-mg1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cb-mg2-AfterProcedure.
      * <TOTEM:PARA. cb-mg2-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cb-mg3-AfterProcedure.
      * <TOTEM:PARA. cb-mg3-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cb-mg4-AfterProcedure.
      * <TOTEM:PARA. cb-mg4-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cb-mg5-AfterProcedure.
      * <TOTEM:PARA. cb-mg5-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cb-int-BeforeProcedure.
      * <TOTEM:PARA. cb-int-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cb-dur-BeforeProcedure.
      * <TOTEM:PARA. cb-dur-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cb-rnd-BeforeProcedure.
      * <TOTEM:PARA. cb-rnd-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cb-int-AfterProcedure.
      * <TOTEM:PARA. cb-int-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cb-dur-AfterProcedure.
      * <TOTEM:PARA. cb-dur-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cb-rnd-AfterProcedure.
      * <TOTEM:PARA. cb-rnd-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           inquire cb-rnd, value in cb-rnd-buf.
           if cb-rnd-buf = "Si"                             
              modify cb-mg1,  value "Nessuno", enabled = false
              modify cb-mg2,  value "Nessuno", enabled = false
              modify cb-mg3,  value "Nessuno", enabled = false
              modify cb-mg4,  value "Nessuno", enabled = false
              modify cb-mg5,  value "Nessuno", enabled = false
              modify cb-mg6,  value "Nessuno", enabled = false
              modify cb-mgtb, value "No",      enabled = false
           else                                              
              modify cb-mg1,  enabled = true
              modify cb-mg2,  enabled = true
              modify cb-mg3,  enabled = true
              modify cb-mg4,  enabled = true
              modify cb-mg5,  enabled = true
              modify cb-mg6,  enabled = true
              modify cb-mgtb, enabled = true
           end-if 
           .
      * <TOTEM:END>
       pb-genera-LinkTo.
      * <TOTEM:PARA. pb-genera-LinkTo>
           perform CREA-OCCURS-GRUPPI.
           modify gd1, reset-grid = 1,
           perform GD1-CONTENT.

           move 0 to int-effort.
           inquire cb-int, value in int-desc.
           read intensity key int-k-desc.
           move int-effort to effort-wod.
           
           inquire cb-dur, value in dur-desc.
           read duration key dur-k-desc.
                 
           accept  como-data from century-date.
           accept  como-ora  from time.
           accept  path-tmp-exe-effort from environment "PATH_ST".
           inspect path-tmp-exe-effort replacing trailing spaces by 
           low-value.
           string  path-tmp-exe-effort delimited low-value
                   "tmp-exe-effort_"   delimited size
                   como-data           delimited size
                   "_"                 delimited size
                   como-ora            delimited size
              into path-tmp-exe-effort
           end-string.                                                  
                 
           inspect path-tmp-exe-effort replacing trailing low-value by 
           spaces.
           open output tmp-exe-effort.    
           close       tmp-exe-effort.
           open i-o    tmp-exe-effort.              
           modify gd1, reset-grid = 1.
           perform GD1-CONTENT.

           perform LOAD-EXERCISES-ALLOWED-BY-EFFORT.
           perform LOAD-EXERCISES-MACROGROUPS-MAP.
           perform LOAD-EXERCISES-MULTIJOINT.
           
           move 1 to riga
           perform varying idx-days from 1 by 1 
                     until idx-days > wom-days
              if idx-days > 1
                 add 1 to riga                           
                 modify gd1(riga, 1), cell-data = "-----"
                 modify gd1(riga, 2), cell-data = "-----"
              end-if   
              perform varying idx-split from 1 by 1 
                        until idx-split > 9
                 if el-wod-mcg(idx-days, idx-split) = spaces
                    exit perform
                 end-if         
                 add 1 to riga                           
                 modify gd1(riga, 1), cell-data = el-wod-mcg(idx-days, 
           idx-split)     
                 modify gd1(riga, 2), cell-data = 
           el-wod-exe-code(idx-days, idx-split)
                 modify gd1(riga, 3), cell-data = 
           el-wod-exe-desc(idx-days, idx-split)
              end-perform
           end-perform.                              
     
      *****     |CARICO ESERCIZI MULTIARTICOLARI
      *****     if cb-mul-buf = "Si"
      *****        move 1 to riga
      *****        initialize tab-exercises replacing numeric data by zeroes 
      *****                                      alphanumeric data by spaces
      *****        perform varying idx-gruppi from 1 by 1 
      *****                  until idx-gruppi > tot-gruppi
      *****           move el-mcg-code(idx-gruppi) to tee-mcg-code
      *****           set  tee-exe-isMulti-yes to true            
      *****           move 0 to idx
      *****
      *****           start tmp-exe-effort key >= tee-k-exe-multi
      *****                 invalid continue
      *****             not invalid
      *****                 perform until 1 = 2        
      *****                    read tmp-exe-effort next
      *****                      at end exit perform 
      *****                    end-read        
      *****                    if tee-mcg-code not = el-mcg-code(idx-gruppi) or
      *****                       tee-exe-isMulti-no
      *****                       exit perform
      *****                    end-if                
      *****                    add 1 to idx
      *****                    move tee-exe-code to el-exe-code(idx)
      *****                    move tee-exe-desc to el-exe-desc(idx)
      *****                    delete tmp-exe-effort record
      *****                 end-perform
      *****           end-start               
      *****           if idx > 0                                    
      *****              move idx to tot-exe tot-righe
      *****              perform until 1 = 2
      *****                 if tot-righe = 0
      *****                    exit perform 
      *****                 end-if
      *****                 compute idx = function random * (tot-exe)
      *****                 add 1 to idx
      *****                 if el-exe-code(idx) not = spaces
      *****                    add 1 to riga                                     
      *****                    modify gd1 (riga, 1), cell-data = el-exe-code(idx)
      *****                    modify gd1 (riga, 2), cell-data = el-exe-desc(idx)
      *****                    move spaces to el-exe-code(idx)
      *****                    subtract 1 from tot-righe
      *****                 end-if
      *****              end-perform
      *****           end-if
      *****        end-perform
      *****     end-if.                

      *****     move 1 to riga.
      *****     perform varying idx-gruppi from 1 by 1 
      *****               until idx-gruppi > tot-gruppi
      *****        move el-mcg-code(idx-gruppi) to tee-mcg-code
      *****        move high-value to tee-int-effort
      *****        start tmp-exe-effort key <= tee-k-mcg-eff
      *****              invalid continue
      *****          not invalid
      *****              perform until 1 = 2
      *****                 if el-exercises-ok(idx-gruppi) = el-exercises(idx-gruppi)
      *****                    exit perform
      *****                 end-if
      *****                 if tee-exe-isMulti-no
      *****                 read tmp-exe-effort previous 
      *****                   at end exit perform 
      *****                 end-read
      *****                 if tee-mcg-code not = el-mcg-code(idx-gruppi)
      *****                    exit perform
      *****                 end-if                
      *****                 add 1 to riga el-exercises-ok(idx-gruppi)
      *****                 modify gd1(riga, 1), cell-data tee-exe-desc
      *****                 delete tmp-exe-effort record
      *****              end-perform
      *****         end-start
      *****     end-perform.  

           close       tmp-exe-effort.
           delete file tmp-exe-effort.
                                                    
      ***---     
      * Load a temporary file that contains only valid exercises filtered
      * by intensity. If choosen "Hard", valid exercise has and effort
      * (intensity table = 3 ) minor/equal, like "Hard" (effort 3), 
      * "Medium" (effort 2) or "Light" (effort 1)
       LOAD-EXERCISES-ALLOWED-BY-EFFORT.
           move low-value to exe-key.
           move 0 to tee-prg.
           start exercises key >= exe-key
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read exercises next at end exit perform end-read
                    move exe-int-code to int-code
                    read intensity no lock
                    move exe-grp-code to grp-code
                    read groups no lock
                    if int-effort <= effort-wod or 
                       exe-isMulti-yes and cb-mul-buf = "Si"
                       perform varying idx-gruppi from 1 by 1 
                                 until idx-gruppi > tot-gruppi
                          if el-mcg-code(idx-gruppi) = grp-mcg-code
                             if exe-isMulti-yes and cb-mul-buf = "No"
                                exit perform cycle
                             end-if
                             add 1 to tee-prg                  
                             move exe-code     to tee-exe-code
                             move exe-desc     to tee-exe-desc
                             move grp-mcg-code to tee-mcg-code
                             move int-effort   to tee-int-effort
                             move exe-isMulti  to tee-exe-isMulti
                             write tee-rec
                          end-if
                       end-perform
                    end-if
                 end-perform
           end-start.                             

      ***---     
      * Starting from wodmap, substitute sign "A" with first macrogroups 
      * selected (and so on) and expands it by the number of exercises 
      * (for the group) indicated (duration table)
      * E.g. day 1 split (wodmap) A - B - C 
      *                  duration 4 - 2 - 2 
      *           selected groups PET - GMB - ARM 
      * result (tab-wod-exe, bidimensional) = PET,PET,PET,PET | GMB,GMB | ARM, ARM
       LOAD-EXERCISES-MACROGROUPS-MAP.
           perform varying idx-days from 1 by 1 
                     until idx-days > wom-days
              move 0 to LastIdx
              perform varying idx-split from 1 by 1 
                        until idx-split > 9
                 if wom-split-el-split-sigla(idx-days, idx-split) = 0
                    exit perform
                 end-if
                 move 0 to idx 
                 evaluate idx-split
                 when 1 move dur-exercises1 to tot-righe
                 when 2 move dur-exercises2 to tot-righe
                 when 3 move dur-exercises3 to tot-righe
                 when 4 move dur-exercises4 to tot-righe
                 when 5 move dur-exercises5 to tot-righe
                 end-evaluate
                 perform tot-righe times
                    add 1 to lastIdx
                    evaluate wom-split-el-split-sigla(idx-days, 
           idx-split)
                    when "A" 
                         move el-mcg-code(1) to el-wod-mcg(idx-days, 
           lastIdx)
                         perform INTENSITY-PER-MACROGROUPS
                    when "B" 
                         move el-mcg-code(2) to el-wod-mcg(idx-days, 
           lastIdx)
                         perform INTENSITY-PER-MACROGROUPS
                    when "C" 
                         move el-mcg-code(3) to el-wod-mcg(idx-days, 
           lastIdx)
                         perform INTENSITY-PER-MACROGROUPS
                    when "D" 
                         move el-mcg-code(4) to el-wod-mcg(idx-days, 
           lastIdx)
                         perform INTENSITY-PER-MACROGROUPS
                    when "E" 
                         move el-mcg-code(5) to el-wod-mcg(idx-days, 
           lastIdx)
                         perform INTENSITY-PER-MACROGROUPS
                    when "F" 
                         move el-mcg-code(6) to el-wod-mcg(idx-days, 
           lastIdx)
                         perform INTENSITY-PER-MACROGROUPS
                    end-evaluate
                 end-perform
              end-perform                                 
           end-perform.         

      ***---
       INTENSITY-PER-MACROGROUPS.
           if idx not = 0 exit paragraph end-if.  
       
      ***---
      * Starting from valid exercises (tmp table) fills the grid
      * corresponding with multi exercise.
      * Phase 1: Scroll occurs (tab-macrogroups), for every macgroups:
      *    read tmp (filtered by macrogroups and multijoint active)
      *    and add the exercise found (code/description) in the relative
      *    occurs tab-exercises, monodimensional.    
      *    The result will be
      *    an occurs (tab-exercise, monodimensional) filled with only
      *    multijoint exercises with selected macrogroups     
      * Phase 2:  (only if exercises found). Scrolling the occurs tab-wod-exe 
      *    searching corresponding macrogroups analyzed fo every day, 
      *    select a random exercise from tab-exercises, then deletes the
      *    value (to avoid duplicate) and subtracts 1 from tot-exe. 
      *    When tot-exe is 0 exits, that menas the exercises are fully selected
       LOAD-EXERCISES-MULTIJOINT.                  
           if cb-mul-buf = "No" exit paragraph end-if.
                                                                  
           perform varying idx-gruppi from 1 by 1 
                     until idx-gruppi > tot-gruppi
              initialize tab-exercises replacing numeric data by zeroes 
                                            alphanumeric data by spaces
             |Phase 1
              move el-mcg-code(idx-gruppi) to tee-mcg-code
              set  tee-exe-isMulti-yes to true            
              move 0 to tot-exe

              start tmp-exe-effort key >= tee-k-exe-multi
                    invalid continue
                not invalid
                    perform until 1 = 2        
                       read tmp-exe-effort next
                         at end exit perform 
                       end-read        
                       if tee-mcg-code not = el-mcg-code(idx-gruppi) or
                          tee-exe-isMulti-no
                          exit perform
                       end-if                
                       add 1 to tot-exe
                       move tee-exe-code to el-exe-code(tot-exe)
                       move tee-exe-desc to el-exe-desc(tot-exe)
                    end-perform
              end-start               
             |Phase 2                                        
              if tot-exe > 0    
                 move tot-exe to ex-remain
                 perform varying idx-days from 1 by 1 
                           until idx-days > wom-days
                    perform varying idx-split from 1 by 1 
                              until idx-split > 9
                       if el-wod-mcg(idx-days, idx-split) = spaces
                          exit perform
                       end-if         
                       if el-wod-mcg(idx-days, idx-split) = 
                          el-mcg-code(idx-gruppi)      
                          perform until 1 = 2
                             compute idx = function random * (tot-exe)
                             add 1 to idx
                             if el-exe-used(idx) = 0 or
                                ex-remain = 0                           
                     
                                move el-exe-code(idx) to 
           el-wod-exe-code(idx-days, idx-split)
                                move el-exe-desc(idx) to 
           el-wod-exe-desc(idx-days, idx-split)
                                move 1                to 
           el-exe-used(idx)
                                subtract 1 from ex-remain
                                exit perform
                             end-if
                          end-perform
                          exit perform
                       end-if
                    end-perform
                 end-perform
              end-if
           end-perform 
           .
      * <TOTEM:END>
       Screen1-Pb-1-LinkTo.
      * <TOTEM:PARA. Screen1-Pb-1-LinkTo>
           modify cb-mg1, value "Legs".
           modify cb-mg2, value "Shoulder".
           modify cb-mg3, value "Arms".
           modify cb-mg4, value "Pectoral".
           modify cb-mg5, value "Back".
           modify cb-mg6, value "Abs".
                                 
           modify cb-int, value = "Hard".
           modify cb-dur, value = "Medium" 
           .
      * <TOTEM:END>
       pb-random-LinkTo.
      * <TOTEM:PARA. pb-random-LinkTo>
           inquire cb-wod, value in wom-desc.
           read wodmap key wom-k-desc.

           move tab-mcg to como-tab-mcg.
           
           move 0 to riga.
           perform until 1 = 2
              if riga = wom-macrogroups
                 exit perform
              end-if
              compute idx = function random * (tot-mcg)
              add 1 to idx
              if como-el-mcg-desc(idx) not = spaces
                 add 1 to riga
                 evaluate riga
                 when 1 modify cb-mg1, value = como-el-mcg-desc(idx)
                 when 2 modify cb-mg2, value = como-el-mcg-desc(idx)
                 when 3 modify cb-mg3, value = como-el-mcg-desc(idx)
                 when 4 modify cb-mg4, value = como-el-mcg-desc(idx)
                 when 5 modify cb-mg5, value = como-el-mcg-desc(idx)
                 when 6 modify cb-mg6, value = como-el-mcg-desc(idx)
                 end-evaluate
                 move spaces to como-el-mcg-desc(idx) 
              end-if
           end-perform 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

