      *{TOTEM}PRG-COMMENT
      * modwod.Cbl
      * modwod.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          modwod.
       AUTHOR.              andre.
       DATE-WRITTEN.        martedì 17 ottobre 2023 16:59:02.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:modwod, INIT:modwod, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "exercises.sl".
           COPY "rwodbook.sl".
           COPY "twodbook.sl".
           COPY "intexe.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "exercises.fd".
           COPY "rwodbook.fd".
           COPY "twodbook.fd".
           COPY "intexe.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "comune.def".
               COPY "custom.def".
               COPY "UTYDATA.DEF".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
      * Properties & User defined Working Stoarge
       77 Form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 TIPO-DATA        PIC  9(8)
                  VALUE IS 0.
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       78 titolo VALUE IS "Gestione esercizi". 
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 1.
       77 E-CANCELLA       PIC  9
                  VALUE IS 1.
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 0.
       77 E-MODIFICA       PIC  9
                  VALUE IS 1.
       77 E-STAMPA         PIC  9
                  VALUE IS 0.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 bmpNum           PIC  999.
       78 78-col-data VALUE IS 1. 
       78 78-col-exe VALUE IS 2. 
       78 78-col-series VALUE IS 3. 
       78 78-col-reps VALUE IS 4. 
       78 78-col-rest VALUE IS 5. 
       78 78-col-rep-1 VALUE IS 6. 
       78 78-col-kg-1 VALUE IS 7. 
       78 78-col-buf-1 VALUE IS 8. 
       78 78-col-rep-2 VALUE IS 9. 
       78 78-col-kg-2 VALUE IS 10. 
       78 78-col-buf-2 VALUE IS 11. 
       78 78-col-rep-3 VALUE IS 12. 
       78 78-col-kg-3 VALUE IS 13. 
       78 78-col-buf-3 VALUE IS 14. 
       78 78-col-rep-4 VALUE IS 15. 
       78 78-col-kg-4 VALUE IS 16. 
       78 78-col-buf-4 VALUE IS 17. 
       78 78-col-rep-5 VALUE IS 18. 
       78 78-col-kg-5 VALUE IS 19. 
       78 78-col-buf-5 VALUE IS 20. 
       78 78-col-note VALUE IS 21. 
       01 rec-grid.
           05 col-data         PIC  x(10).
           05 col-exe          PIC  x(50).
           05 col-series       PIC  z9.
           05 col-reps         PIC  X(20).
           05 col-rest         PIC  zz9.
           05 col-rep-1        PIC  x(3).
           05 col-kg-1         PIC  x(3).
           05 col-buf-1        PIC  x(3).
           05 col-rep-2        PIC  x(3).
           05 col-kg-2         PIC  x(3).
           05 col-buf-2        PIC  x(3).
           05 col-rep-3        PIC  x(3).
           05 col-kg-3         PIC  x(3).
           05 col-buf-3        PIC  x(3).
           05 col-rep-4        PIC  x(3).
           05 col-kg-4         PIC  x(3).
           05 col-buf-4        PIC  x(3).
           05 col-rep-5        PIC  x(3).
           05 col-kg-5         PIC  x(3).
           05 col-buf-5        PIC  x(3).
           05 col-note         PIC  x(100).
       77 ws-narg          PIC  99
                  USAGE IS COMP-1.
       77 e-cerca          PIC  9
                  VALUE IS 0.
       77 s-rod-exe-code   PIC  x(5).
       77 s-rod-int-code   PIC  99.
       77 s-rod-day        PIC  9(8).
       77 code-x           PIC  x(18).
       01 FILLER           PIC  9.
           88 confronto VALUE IS 1    WHEN SET TO FALSE  0. 
       77 como-code        PIC  9(18).
       77 como-titolo      PIC  x(50).
       77 colore           PIC  999.
       77 como-giorno      PIC  9(8).
       77 Screen1-Handle
                  USAGE IS HANDLE OF WINDOW.
       01 FILLER           PIC  9.
           88 ricarica VALUE IS 1    WHEN SET TO FALSE  0. 
       77 esegui-73x21-bmp PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 STATUS-exercises PIC  X(2).
           88 Valid-STATUS-exercises VALUE IS "00" THRU "09". 
       77 Calibri14-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 LOGO-PICCOLO-BMP PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 STATUS-groups    PIC  X(2).
           88 Valid-STATUS-groups VALUE IS "00" THRU "09". 
       77 STATUS-intexe    PIC  X(2).
           88 Valid-STATUS-intexe VALUE IS "00" THRU "09". 
       77 STATUS-macrogroups           PIC  X(2).
           88 Valid-STATUS-macrogroups VALUE IS "00" THRU "09". 
       77 path-tmp-exe-mcg PIC  X(256).
       77 STATUS-tmp-exe-mcg           PIC  X(2).
           88 Valid-STATUS-tmp-exe-mcg VALUE IS "00" THRU "09". 
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 32.
       77 E-SELEZIONA      PIC  9
                  VALUE IS 1.
       77 Calibri12-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 STATUS-rwodbook  PIC  X(2).
           88 Valid-STATUS-rwodbook VALUE IS "00" THRU "09". 
       77 STATUS-twodbook  PIC  X(2).
           88 Valid-STATUS-twodbook VALUE IS "00" THRU "09". 
       77 lab-desc-buf     PIC  x(100).
       77 Calibri18B-Occidentale
                  USAGE IS HANDLE OF FONT.

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-twodbook-RESTOREBUF  PIC X(2305).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(2305).
       77 TMP-DataSet1-exercises-BUF     PIC X(1189).
       77 TMP-DataSet1-rwodbook-BUF     PIC X(2346).
       77 TMP-DataSet1-twodbook-BUF     PIC X(2305).
       77 TMP-DataSet1-intexe-BUF     PIC X(1188).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-exercises-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-exercises-LOCK  VALUE "Y".
       77 DataSet1-exercises-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-exercises-KEY-Asc  VALUE "A".
          88 DataSet1-exercises-KEY-Desc VALUE "D".
       77 DataSet1-rwodbook-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rwodbook-LOCK  VALUE "Y".
       77 DataSet1-rwodbook-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rwodbook-KEY-Asc  VALUE "A".
          88 DataSet1-rwodbook-KEY-Desc VALUE "D".
       77 DataSet1-twodbook-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-twodbook-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-twodbook-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-twodbook-KEY1-Asc  VALUE "A".
          88 DataSet1-twodbook-KEY1-Desc VALUE "D".
       77 DataSet1-intexe-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-intexe-LOCK  VALUE "Y".
       77 DataSet1-intexe-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-intexe-KEY-Asc  VALUE "A".
          88 DataSet1-intexe-KEY-Desc VALUE "D".

       77 exercises-exe-k-desc-SPLITBUF  PIC X(101).
       77 exercises-exe-k-group-SPLITBUF  PIC X(11).
       77 rwodbook-rod-k-day-SPLITBUF  PIC X(29).
       77 rwodbook-rod-k-prg-SPLITBUF  PIC X(30).
       77 rwodbook-rod-k-mcg-SPLITBUF  PIC X(34).
       77 rwodbook-rod-k-exe-SPLITBUF  PIC X(34).
       77 rwodbook-rod-k-multi-SPLITBUF  PIC X(35).
       77 rwodbook-rod-k-rp-SPLITBUF  PIC X(35).
       77 rwodbook-rod-k-ss-SPLITBUF  PIC X(35).
       77 rwodbook-rod-k-confronto-SPLITBUF  PIC X(16).
       77 twodbook-tod-k-creazione-SPLITBUF  PIC X(27).
       77 twodbook-tod-k-wom-SPLITBUF  PIC X(22).
       77 twodbook-tod-k-desc-SPLITBUF  PIC X(119).
       77 twodbook-tod-k-ini-SPLITBUF  PIC X(27).
       77 twodbook-tod-k-eff-SPLITBUF  PIC X(21).
       77 twodbook-tod-k-dur-SPLITBUF  PIC X(21).
       77 intexe-int-k-desc-SPLITBUF  PIC X(101).
       77 intexe-int-k-effort-SPLITBUF  PIC X(3).

       01 old-exe-rec.
           05 old-exe-key.
               10 old-exe-code         PIC  x(5).
           05 old-exe-data.
               10 old-exe-desc         PIC  x(100).
               10 old-exe-grp-code     PIC  x(5).
               10 old-exe-int-code     PIC  99.
               10 old-exe-isMulti      PIC  9.
                   88 old-exe-isMulti-no VALUE IS 0. 
                   88 old-exe-isMulti-yes VALUE IS 1. 
               10 old-exe-setting      PIC  9(4).
               10 old-exe-restpause    PIC  9.
               10 old-exe-disab        PIC  9.
               10 old-exe-desc-stampa  PIC  x(20).
               10 old-exe-note         PIC  x(278).
               10 old-exe-filler       PIC  x(700).
               10 old-exe-filler-n1    PIC  9(18).
               10 old-exe-filler-n2    PIC  9(18).
               10 old-exe-filler-n3    PIC  9(18).
               10 old-exe-filler-n4    PIC  9(18).
      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-form1-gd-1 VALUE 5001.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "F:\STUDIOPOSTURA\COPYLIB\BLOCKPGM.LKS".
       01 lnk-code         PIC  9(18).

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           .

      * GRID
       05
           form1-gd-1, 
           Grid, 
           COL 2,80, 
           LINE 2,87,
           LINES 36,61 ,
           SIZE 164,90 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           DATA-COLUMNS (1, 11, 61, 63, 83, 86, 89, 92, 95, 98, 101, 
           104, 107, 110, 113, 116, 119, 122, 125, 128, 131),
           ALIGNMENT ("C", "U", "R", "U", "R", "C", "C", "C", "C", "C", 
           "C", "C", "C", "C", "C", "C", "C", "C", "C", "C", "U"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 
           5, 5, 5, 5, 5),
           DATA-TYPES ("X", "U(5)", "X(100)", "X(20)", "U(5)", "x(3)", 
           "x(3)", "x(3)", "x(3)", "x(3)", "x(3)", "x(3)", "x(3)", "x(3)
      -    "", "x(3)", "x(3)", "x(3)", "x(3)", "x(3)", "x(3)", "X"),
           COLUMN-DIVIDERS (3, 3, 3, 3, 3, 1, 1, 3, 1, 1, 3, 1, 1, 3, 
           1, 1, 3, 1, 1, 3, 1),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           FONT IS Calibri14-Occidentale,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           HSCROLL,
           ID IS 78-ID-form1-gd-1,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RECORD-DATA rec-grid,
           TILED-HEADINGS,
           USE-TAB,
           VIRTUAL-WIDTH 163,
           VPADDING 1,
           VSCROLL,
           EVENT PROCEDURE Form1-Gd-1-Event-Proc,
           .

      * LABEL
       05
           Form1-blockpgm-1, 
           Label, 
           COL 134,50, 
           LINE 1,70,
           LINES 1,00 ,
           SIZE 1,00 ,
           FONT IS Calibri12-Occidentale,
           ID IS AUTO-ID,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Form1-Custom1-1, 
           Label, 
           COL 130,50, 
           LINE 1,22,
           LINES 0,70 ,
           SIZE 1,00 ,
           FONT IS Default-Font,
           ID IS 33,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       05
           lab-desc, 
           Label, 
           COL 2,80, 
           LINE 1,22,
           LINES 1,13 ,
           SIZE 164,90 ,
           COLOR IS 5,
           FONT IS Calibri18B-Occidentale,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-desc-buf,
           .

      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 2,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "&Esci",
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 6,60, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 3,
           UNFRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           ID IS 30,
           SELF-ACT,
           TITLE "Salva (F3)",
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 12,20, 
           LINE 1,09,
           LINES 64,00 ,
           SIZE 48,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 8,
           UNFRAMED,
           SQUARE,
           ENABLED 0,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 31,
           SELF-ACT,
           TITLE "Salva (F3)",
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, lnk-code.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:modwod, INIT:modwod, BeforeDeclarative>
      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM PAS004P-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:modwod, INIT:modwod, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Calibri14-Occidentale
           DESTROY Calibri12-Occidentale
           DESTROY Calibri18B-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
      *    After-Program
           PERFORM I-O-BLOCCO
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Calibri14-Occidentale
           INITIALIZE WFONT-DATA Calibri14-Occidentale
           MOVE 14 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri14-Occidentale, WFONT-DATA
      * Calibri12-Occidentale
           INITIALIZE WFONT-DATA Calibri12-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri12-Occidentale, WFONT-DATA
      * Calibri18B-Occidentale
           INITIALIZE WFONT-DATA Calibri18B-Occidentale
           MOVE 18 TO WFONT-SIZE
           MOVE "Calibri" TO WFONT-NAME
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Calibri18B-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-exercises
           PERFORM OPEN-rwodbook
           PERFORM OPEN-twodbook
           PERFORM OPEN-intexe
      *    After Open
           .

       OPEN-exercises.
      * <TOTEM:EPT. INIT:modwod, FD:exercises, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT exercises
           IF NOT Valid-STATUS-exercises
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:modwod, FD:exercises, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rwodbook.
      * <TOTEM:EPT. INIT:modwod, FD:rwodbook, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O rwodbook
           IF STATUS-rwodbook = "35"
              OPEN OUTPUT rwodbook
                IF Valid-STATUS-rwodbook
                   CLOSE rwodbook
                   OPEN I-O rwodbook
                END-IF
           END-IF
           IF NOT Valid-STATUS-rwodbook
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:modwod, FD:rwodbook, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-twodbook.
      * <TOTEM:EPT. INIT:modwod, FD:twodbook, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O twodbook
           IF STATUS-twodbook = "35"
              OPEN OUTPUT twodbook
                IF Valid-STATUS-twodbook
                   CLOSE twodbook
                   OPEN I-O twodbook
                END-IF
           END-IF
           IF NOT Valid-STATUS-twodbook
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:modwod, FD:twodbook, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-intexe.
      * <TOTEM:EPT. INIT:modwod, FD:intexe, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT intexe
           IF NOT Valid-STATUS-intexe
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:modwod, FD:intexe, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-exercises
           PERFORM CLOSE-rwodbook
           PERFORM CLOSE-twodbook
           PERFORM CLOSE-intexe
      *    After Close
           .

       CLOSE-exercises.
      * <TOTEM:EPT. INIT:modwod, FD:exercises, BeforeClose>
      * <TOTEM:END>
           CLOSE exercises
           .

       CLOSE-rwodbook.
      * <TOTEM:EPT. INIT:modwod, FD:rwodbook, BeforeClose>
      * <TOTEM:END>
           CLOSE rwodbook
           .

       CLOSE-twodbook.
      * <TOTEM:EPT. INIT:modwod, FD:twodbook, BeforeClose>
      * <TOTEM:END>
           CLOSE twodbook
           .

       CLOSE-intexe.
      * <TOTEM:EPT. INIT:modwod, FD:intexe, BeforeClose>
      * <TOTEM:END>
           CLOSE intexe
           .

       exercises-exe-k-desc-MERGE-SPLITBUF.
           INITIALIZE exercises-exe-k-desc-SPLITBUF
           MOVE exe-desc(1:100) TO exercises-exe-k-desc-SPLITBUF(1:100)
           .

       exercises-exe-k-group-MERGE-SPLITBUF.
           INITIALIZE exercises-exe-k-group-SPLITBUF
           MOVE exe-grp-code(1:5) TO exercises-exe-k-group-SPLITBUF(1:5)
           MOVE exe-key(1:5) TO exercises-exe-k-group-SPLITBUF(6:5)
           .

       DataSet1-exercises-INITSTART.
           IF DataSet1-exercises-KEY-Asc
              MOVE Low-Value TO exe-key
           ELSE
              MOVE High-Value TO exe-key
           END-IF
           .

       DataSet1-exercises-INITEND.
           IF DataSet1-exercises-KEY-Asc
              MOVE High-Value TO exe-key
           ELSE
              MOVE Low-Value TO exe-key
           END-IF
           .

      * exercises
       DataSet1-exercises-START.
           IF DataSet1-exercises-KEY-Asc
              START exercises KEY >= exe-key
           ELSE
              START exercises KEY <= exe-key
           END-IF
           .

       DataSet1-exercises-START-NOTGREATER.
           IF DataSet1-exercises-KEY-Asc
              START exercises KEY <= exe-key
           ELSE
              START exercises KEY >= exe-key
           END-IF
           .

       DataSet1-exercises-START-GREATER.
           IF DataSet1-exercises-KEY-Asc
              START exercises KEY > exe-key
           ELSE
              START exercises KEY < exe-key
           END-IF
           .

       DataSet1-exercises-START-LESS.
           IF DataSet1-exercises-KEY-Asc
              START exercises KEY < exe-key
           ELSE
              START exercises KEY > exe-key
           END-IF
           .

       DataSet1-exercises-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-exercises-LOCK
              READ exercises WITH LOCK 
              KEY exe-key
           ELSE
              READ exercises WITH NO LOCK 
              KEY exe-key
           END-IF
           PERFORM exercises-exe-k-desc-MERGE-SPLITBUF
           PERFORM exercises-exe-k-group-MERGE-SPLITBUF
           MOVE STATUS-exercises TO TOTEM-ERR-STAT 
           MOVE "exercises" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-exercises-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-exercises-KEY-Asc
              IF DataSet1-exercises-LOCK
                 READ exercises NEXT WITH LOCK
              ELSE
                 READ exercises NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-exercises-LOCK
                 READ exercises PREVIOUS WITH LOCK
              ELSE
                 READ exercises PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM exercises-exe-k-desc-MERGE-SPLITBUF
           PERFORM exercises-exe-k-group-MERGE-SPLITBUF
           MOVE STATUS-exercises TO TOTEM-ERR-STAT
           MOVE "exercises" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-exercises-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-exercises-KEY-Asc
              IF DataSet1-exercises-LOCK
                 READ exercises PREVIOUS WITH LOCK
              ELSE
                 READ exercises PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-exercises-LOCK
                 READ exercises NEXT WITH LOCK
              ELSE
                 READ exercises NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM exercises-exe-k-desc-MERGE-SPLITBUF
           PERFORM exercises-exe-k-group-MERGE-SPLITBUF
           MOVE STATUS-exercises TO TOTEM-ERR-STAT
           MOVE "exercises" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-exercises-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-exercises TO TOTEM-ERR-STAT
           MOVE "exercises" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-exercises-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-exercises TO TOTEM-ERR-STAT
           MOVE "exercises" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-exercises-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-exercises TO TOTEM-ERR-STAT
           MOVE "exercises" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:exercises, AfterDelete>
      * <TOTEM:END>
           .

       rwodbook-rod-k-day-MERGE-SPLITBUF.
           INITIALIZE rwodbook-rod-k-day-SPLITBUF
           MOVE rod-day(1:8) TO rwodbook-rod-k-day-SPLITBUF(1:8)
           MOVE rod-split(1:2) TO rwodbook-rod-k-day-SPLITBUF(9:2)
           MOVE rod-code(1:18) TO rwodbook-rod-k-day-SPLITBUF(11:18)
           .

       rwodbook-rod-k-prg-MERGE-SPLITBUF.
           INITIALIZE rwodbook-rod-k-prg-SPLITBUF
           MOVE rod-key(1:28) TO rwodbook-rod-k-prg-SPLITBUF(1:28)
           MOVE rod-prg-day(1:1) TO rwodbook-rod-k-prg-SPLITBUF(29:1)
           .

       rwodbook-rod-k-mcg-MERGE-SPLITBUF.
           INITIALIZE rwodbook-rod-k-mcg-SPLITBUF
           MOVE rod-mcg-code(1:5) TO rwodbook-rod-k-mcg-SPLITBUF(1:5)
           MOVE rod-key(1:28) TO rwodbook-rod-k-mcg-SPLITBUF(6:28)
           .

       rwodbook-rod-k-exe-MERGE-SPLITBUF.
           INITIALIZE rwodbook-rod-k-exe-SPLITBUF
           MOVE rod-exe-code(1:5) TO rwodbook-rod-k-exe-SPLITBUF(1:5)
           MOVE rod-key(1:28) TO rwodbook-rod-k-exe-SPLITBUF(6:28)
           .

       rwodbook-rod-k-multi-MERGE-SPLITBUF.
           INITIALIZE rwodbook-rod-k-multi-SPLITBUF
           MOVE rod-exe-isMulti(1:1) TO 
           rwodbook-rod-k-multi-SPLITBUF(1:1)
           MOVE rod-mcg-code(1:5) TO rwodbook-rod-k-multi-SPLITBUF(2:5)
           MOVE rod-key(1:28) TO rwodbook-rod-k-multi-SPLITBUF(7:28)
           .

       rwodbook-rod-k-rp-MERGE-SPLITBUF.
           INITIALIZE rwodbook-rod-k-rp-SPLITBUF
           MOVE rod-int-restpause(1:1) TO 
           rwodbook-rod-k-rp-SPLITBUF(1:1)
           MOVE rod-mcg-code(1:5) TO rwodbook-rod-k-rp-SPLITBUF(2:5)
           MOVE rod-key(1:28) TO rwodbook-rod-k-rp-SPLITBUF(7:28)
           .

       rwodbook-rod-k-ss-MERGE-SPLITBUF.
           INITIALIZE rwodbook-rod-k-ss-SPLITBUF
           MOVE rod-ss(1:1) TO rwodbook-rod-k-ss-SPLITBUF(1:1)
           MOVE rod-mcg-code(1:5) TO rwodbook-rod-k-ss-SPLITBUF(2:5)
           MOVE rod-key(1:28) TO rwodbook-rod-k-ss-SPLITBUF(7:28)
           .

       rwodbook-rod-k-confronto-MERGE-SPLITBUF.
           INITIALIZE rwodbook-rod-k-confronto-SPLITBUF
           MOVE rod-exe-code(1:5) TO 
           rwodbook-rod-k-confronto-SPLITBUF(1:5)
           MOVE rod-int-code(1:2) TO 
           rwodbook-rod-k-confronto-SPLITBUF(6:2)
           MOVE rod-day(1:8) TO rwodbook-rod-k-confronto-SPLITBUF(8:8)
           .

       DataSet1-rwodbook-INITSTART.
           IF DataSet1-rwodbook-KEY-Asc
              MOVE Low-Value TO rod-key
           ELSE
              MOVE High-Value TO rod-key
           END-IF
           .

       DataSet1-rwodbook-INITEND.
           IF DataSet1-rwodbook-KEY-Asc
              MOVE High-Value TO rod-key
           ELSE
              MOVE Low-Value TO rod-key
           END-IF
           .

      * rwodbook
       DataSet1-rwodbook-START.
           IF DataSet1-rwodbook-KEY-Asc
              START rwodbook KEY >= rod-key
           ELSE
              START rwodbook KEY <= rod-key
           END-IF
           .

       DataSet1-rwodbook-START-NOTGREATER.
           IF DataSet1-rwodbook-KEY-Asc
              START rwodbook KEY <= rod-key
           ELSE
              START rwodbook KEY >= rod-key
           END-IF
           .

       DataSet1-rwodbook-START-GREATER.
           IF DataSet1-rwodbook-KEY-Asc
              START rwodbook KEY > rod-key
           ELSE
              START rwodbook KEY < rod-key
           END-IF
           .

       DataSet1-rwodbook-START-LESS.
           IF DataSet1-rwodbook-KEY-Asc
              START rwodbook KEY < rod-key
           ELSE
              START rwodbook KEY > rod-key
           END-IF
           .

       DataSet1-rwodbook-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rwodbook-LOCK
              READ rwodbook WITH LOCK 
              KEY rod-key
           ELSE
              READ rwodbook WITH NO LOCK 
              KEY rod-key
           END-IF
           PERFORM rwodbook-rod-k-day-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-prg-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-mcg-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-exe-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-multi-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-rp-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-ss-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-confronto-MERGE-SPLITBUF
           MOVE STATUS-rwodbook TO TOTEM-ERR-STAT 
           MOVE "rwodbook" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rwodbook-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rwodbook-KEY-Asc
              IF DataSet1-rwodbook-LOCK
                 READ rwodbook NEXT WITH LOCK
              ELSE
                 READ rwodbook NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rwodbook-LOCK
                 READ rwodbook PREVIOUS WITH LOCK
              ELSE
                 READ rwodbook PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rwodbook-rod-k-day-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-prg-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-mcg-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-exe-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-multi-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-rp-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-ss-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-confronto-MERGE-SPLITBUF
           MOVE STATUS-rwodbook TO TOTEM-ERR-STAT
           MOVE "rwodbook" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rwodbook-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rwodbook-KEY-Asc
              IF DataSet1-rwodbook-LOCK
                 READ rwodbook PREVIOUS WITH LOCK
              ELSE
                 READ rwodbook PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rwodbook-LOCK
                 READ rwodbook NEXT WITH LOCK
              ELSE
                 READ rwodbook NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rwodbook-rod-k-day-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-prg-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-mcg-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-exe-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-multi-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-rp-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-ss-MERGE-SPLITBUF
           PERFORM rwodbook-rod-k-confronto-MERGE-SPLITBUF
           MOVE STATUS-rwodbook TO TOTEM-ERR-STAT
           MOVE "rwodbook" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rwodbook-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, BeforeWrite>
      * <TOTEM:END>
           WRITE rod-rec OF rwodbook.
           MOVE STATUS-rwodbook TO TOTEM-ERR-STAT
           MOVE "rwodbook" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rwodbook-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, BeforeRewrite>
      * <TOTEM:END>
           REWRITE rod-rec OF rwodbook.
           MOVE STATUS-rwodbook TO TOTEM-ERR-STAT
           MOVE "rwodbook" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rwodbook-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, BeforeDelete>
      * <TOTEM:END>
           DELETE rwodbook.
           MOVE STATUS-rwodbook TO TOTEM-ERR-STAT
           MOVE "rwodbook" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rwodbook, AfterDelete>
      * <TOTEM:END>
           .

       twodbook-tod-k-creazione-MERGE-SPLITBUF.
           INITIALIZE twodbook-tod-k-creazione-SPLITBUF
           MOVE tod-data-creazione(1:8) TO 
           twodbook-tod-k-creazione-SPLITBUF(1:8)
           MOVE tod-key(1:18) TO twodbook-tod-k-creazione-SPLITBUF(9:18)
           .

       twodbook-tod-k-wom-MERGE-SPLITBUF.
           INITIALIZE twodbook-tod-k-wom-SPLITBUF
           MOVE tod-wom-code(1:3) TO twodbook-tod-k-wom-SPLITBUF(1:3)
           MOVE tod-key(1:18) TO twodbook-tod-k-wom-SPLITBUF(4:18)
           .

       twodbook-tod-k-desc-MERGE-SPLITBUF.
           INITIALIZE twodbook-tod-k-desc-SPLITBUF
           MOVE tod-desc(1:100) TO twodbook-tod-k-desc-SPLITBUF(1:100)
           MOVE tod-key(1:18) TO twodbook-tod-k-desc-SPLITBUF(101:18)
           .

       twodbook-tod-k-ini-MERGE-SPLITBUF.
           INITIALIZE twodbook-tod-k-ini-SPLITBUF
           MOVE tod-day-ini(1:8) TO twodbook-tod-k-ini-SPLITBUF(1:8)
           MOVE tod-key(1:18) TO twodbook-tod-k-ini-SPLITBUF(9:18)
           .

       twodbook-tod-k-eff-MERGE-SPLITBUF.
           INITIALIZE twodbook-tod-k-eff-SPLITBUF
           MOVE tod-wom-effort(1:2) TO twodbook-tod-k-eff-SPLITBUF(1:2)
           MOVE tod-key(1:18) TO twodbook-tod-k-eff-SPLITBUF(3:18)
           .

       twodbook-tod-k-dur-MERGE-SPLITBUF.
           INITIALIZE twodbook-tod-k-dur-SPLITBUF
           MOVE tod-dur-code(1:2) TO twodbook-tod-k-dur-SPLITBUF(1:2)
           MOVE tod-key(1:18) TO twodbook-tod-k-dur-SPLITBUF(3:18)
           .

       DataSet1-twodbook-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-twodbook-KEY1-Asc
                 MOVE Low-Value TO tod-key
              ELSE
                 MOVE High-Value TO tod-key
              END-IF
           END-EVALUATE
           .

       DataSet1-twodbook-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-twodbook-KEY1-Asc
                 MOVE High-Value TO tod-key
              ELSE
                 MOVE Low-Value TO tod-key
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-twodbook-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-twodbook-KEY1-ORDER
           END-EVALUATE
           .

      * twodbook
       DataSet1-twodbook-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-twodbook-KEY1-Asc
                 START twodbook KEY >= tod-key
              ELSE
                 START twodbook KEY <= tod-key
              END-IF
           END-EVALUATE
           .

       DataSet1-twodbook-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-twodbook-KEY1-Asc
                 START twodbook KEY <= tod-key
              ELSE
                 START twodbook KEY >= tod-key
              END-IF
           END-EVALUATE
           .

       DataSet1-twodbook-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-twodbook-KEY1-Asc
                 START twodbook KEY > tod-key
              ELSE
                 START twodbook KEY < tod-key
              END-IF
           END-EVALUATE
           .

       DataSet1-twodbook-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-twodbook-KEY1-Asc
                 START twodbook KEY < tod-key
              ELSE
                 START twodbook KEY > tod-key
              END-IF
           END-EVALUATE
           .

       DataSet1-twodbook-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-twodbook-LOCK
                 READ twodbook WITH LOCK 
                 KEY tod-key
              ELSE
                 READ twodbook WITH NO LOCK 
                 KEY tod-key
              END-IF
           END-EVALUATE
           PERFORM twodbook-tod-k-creazione-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-wom-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-desc-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-ini-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-eff-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-dur-MERGE-SPLITBUF
           MOVE STATUS-twodbook TO TOTEM-ERR-STAT 
           MOVE "twodbook" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-twodbook-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-twodbook-KEY1-Asc
                 IF DataSet1-twodbook-LOCK
                    READ twodbook NEXT WITH LOCK
                 ELSE
                    READ twodbook NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-twodbook-LOCK
                    READ twodbook PREVIOUS WITH LOCK
                 ELSE
                    READ twodbook PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM twodbook-tod-k-creazione-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-wom-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-desc-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-ini-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-eff-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-dur-MERGE-SPLITBUF
           MOVE STATUS-twodbook TO TOTEM-ERR-STAT
           MOVE "twodbook" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-twodbook-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-twodbook-KEY1-Asc
                 IF DataSet1-twodbook-LOCK
                    READ twodbook PREVIOUS WITH LOCK
                 ELSE
                    READ twodbook PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-twodbook-LOCK
                    READ twodbook NEXT WITH LOCK
                 ELSE
                    READ twodbook NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM twodbook-tod-k-creazione-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-wom-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-desc-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-ini-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-eff-MERGE-SPLITBUF
           PERFORM twodbook-tod-k-dur-MERGE-SPLITBUF
           MOVE STATUS-twodbook TO TOTEM-ERR-STAT
           MOVE "twodbook" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-twodbook-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, BeforeWrite>
      * <TOTEM:END>
           WRITE tod-rec OF twodbook.
           MOVE STATUS-twodbook TO TOTEM-ERR-STAT
           MOVE "twodbook" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-twodbook-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, BeforeRewrite>
      * <TOTEM:END>
           REWRITE tod-rec OF twodbook.
           MOVE STATUS-twodbook TO TOTEM-ERR-STAT
           MOVE "twodbook" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-twodbook-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, BeforeDelete>
      * <TOTEM:END>
           DELETE twodbook.
           MOVE STATUS-twodbook TO TOTEM-ERR-STAT
           MOVE "twodbook" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:twodbook, AfterDelete>
      * <TOTEM:END>
           .

       intexe-int-k-desc-MERGE-SPLITBUF.
           INITIALIZE intexe-int-k-desc-SPLITBUF
           MOVE int-desc(1:100) TO intexe-int-k-desc-SPLITBUF(1:100)
           .

       intexe-int-k-effort-MERGE-SPLITBUF.
           INITIALIZE intexe-int-k-effort-SPLITBUF
           MOVE int-effort(1:2) TO intexe-int-k-effort-SPLITBUF(1:2)
           .

       DataSet1-intexe-INITSTART.
           IF DataSet1-intexe-KEY-Asc
              MOVE Low-Value TO int-key
           ELSE
              MOVE High-Value TO int-key
           END-IF
           .

       DataSet1-intexe-INITEND.
           IF DataSet1-intexe-KEY-Asc
              MOVE High-Value TO int-key
           ELSE
              MOVE Low-Value TO int-key
           END-IF
           .

      * intexe
       DataSet1-intexe-START.
           IF DataSet1-intexe-KEY-Asc
              START intexe KEY >= int-key
           ELSE
              START intexe KEY <= int-key
           END-IF
           .

       DataSet1-intexe-START-NOTGREATER.
           IF DataSet1-intexe-KEY-Asc
              START intexe KEY <= int-key
           ELSE
              START intexe KEY >= int-key
           END-IF
           .

       DataSet1-intexe-START-GREATER.
           IF DataSet1-intexe-KEY-Asc
              START intexe KEY > int-key
           ELSE
              START intexe KEY < int-key
           END-IF
           .

       DataSet1-intexe-START-LESS.
           IF DataSet1-intexe-KEY-Asc
              START intexe KEY < int-key
           ELSE
              START intexe KEY > int-key
           END-IF
           .

       DataSet1-intexe-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-intexe-LOCK
              READ intexe WITH LOCK 
              KEY int-key
           ELSE
              READ intexe WITH NO LOCK 
              KEY int-key
           END-IF
           PERFORM intexe-int-k-desc-MERGE-SPLITBUF
           PERFORM intexe-int-k-effort-MERGE-SPLITBUF
           MOVE STATUS-intexe TO TOTEM-ERR-STAT 
           MOVE "intexe" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-intexe-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-intexe-KEY-Asc
              IF DataSet1-intexe-LOCK
                 READ intexe NEXT WITH LOCK
              ELSE
                 READ intexe NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-intexe-LOCK
                 READ intexe PREVIOUS WITH LOCK
              ELSE
                 READ intexe PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM intexe-int-k-desc-MERGE-SPLITBUF
           PERFORM intexe-int-k-effort-MERGE-SPLITBUF
           MOVE STATUS-intexe TO TOTEM-ERR-STAT
           MOVE "intexe" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-intexe-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-intexe-KEY-Asc
              IF DataSet1-intexe-LOCK
                 READ intexe PREVIOUS WITH LOCK
              ELSE
                 READ intexe PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-intexe-LOCK
                 READ intexe NEXT WITH LOCK
              ELSE
                 READ intexe NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM intexe-int-k-desc-MERGE-SPLITBUF
           PERFORM intexe-int-k-effort-MERGE-SPLITBUF
           MOVE STATUS-intexe TO TOTEM-ERR-STAT
           MOVE "intexe" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-intexe-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-intexe TO TOTEM-ERR-STAT
           MOVE "intexe" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-intexe-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-intexe TO TOTEM-ERR-STAT
           MOVE "intexe" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-intexe-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-intexe TO TOTEM-ERR-STAT
           MOVE "intexe" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:intexe, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE exe-rec OF exercises
           INITIALIZE rod-rec OF rwodbook
           INITIALIZE tod-rec OF twodbook
           INITIALIZE int-rec OF intexe
           .


      * GRID
       form1-gd-1-Content.
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 1, Y = 1,
                CELL-DATA = "DATA",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 2, Y = 1,
                CELL-DATA = "EXERCISE",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 3, Y = 1,
                CELL-DATA = "S",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 4, Y = 1,
                CELL-DATA = "REPS",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 5, Y = 1,
                CELL-DATA = 'R "',
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 6, Y = 1,
                CELL-DATA = "REP1",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 7, Y = 1,
                CELL-DATA = "KG1",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 8, Y = 1,
                CELL-DATA = "BUF1",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 9, Y = 1,
                CELL-DATA = "REP2",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 10, Y = 1,
                CELL-DATA = "KG2",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 11, Y = 1,
                CELL-DATA = "BUF2",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 12, Y = 1,
                CELL-DATA = "REP3",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 13, Y = 1,
                CELL-DATA = "KG3",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 14, Y = 1,
                CELL-DATA = "BUF3",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 15, Y = 1,
                CELL-DATA = "REP4",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 16, Y = 1,
                CELL-DATA = "KG4",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 17, Y = 1,
                CELL-DATA = "BUF4",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 18, Y = 1,
                CELL-DATA = "REP5",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 19, Y = 1,
                CELL-DATA = "KG5",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 20, Y = 1,
                CELL-DATA = "BUF5",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 21, Y = 1,
                CELL-DATA = "NOTE",
           .

      * FD's Initialize Paragraph
       DataSet1-exercises-INITREC.
           INITIALIZE exe-rec OF exercises
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rwodbook-INITREC.
           INITIALIZE rod-rec OF rwodbook
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-twodbook-INITREC.
           INITIALIZE tod-rec OF twodbook
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-intexe-INITREC.
           INITIALIZE int-rec OF intexe
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              SCREEN LINE 1,
              SCREEN COLUMN 0,
              LINES 39,17,
              SIZE 168,60,
              COLOR 131329,
              CONTROL FONT Calibri14-Occidentale,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Form1-Event-Proc,
              HANDLE IS Form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 3,35,   
              CONTROL FONT IS Calibri14-Occidentale
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY Form1 UPON Form1-Handle
      * DISPLAY-COLUMNS settings
              MODIFY form1-gd-1, DISPLAY-COLUMNS (1, 11, 31, 35, 45, 
           49, 54, 59, 64, 69, 74, 79, 84, 89, 94, 99, 104, 109, 114, 
           119, 124)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           initialize lab-desc-buf
           if como-code not = 0
              move como-code to tod-code
              read twodbook
              move como-code to code-x
              inspect code-x replacing leading x"30" by x"20" 
              call "C$JUSTIFY" using code-x, "L"
              inspect code-x   replacing trailing spaces by low-value
              string  code-x   delimited low-value 
                      " - "    delimited size
                      tod-desc delimited size
                 into lab-desc-buf
              end-string
              set confronto to false
              perform CARICA-WOD
           else                                 
              modify tool-salva, enabled false
              call   "gwod" using lk-blockpgm,
                                  como-code
              cancel "gwod"
              if como-code = 0
                 modify tool-cerca, enabled true
              else                    
                 move como-code to tod-code
                 read twodbook
                 move como-code to code-x
                 inspect code-x replacing leading x"30" by x"20" 
                 call "C$JUSTIFY" using code-x, "L"
                 inspect code-x   replacing trailing spaces by low-value
                 string  code-x   delimited low-value 
                         " - "    delimited size
                         tod-desc delimited size
                    into lab-desc-buf
                 end-string

                 set confronto to true
                 perform CARICA-WOD
                 perform CARICA-CONFRONTI
              end-if
           end-if.
           display lab-desc.

           move 2 to riga.
           move 78-col-rep-1 to colonna.
           modify form1-gd-1, cursor-y = 2, cursor-x colonna.
           perform SPOSTAMENTO.

      *     set vecchio to true.
      *     perform ABILITA-TOOLBAR.
      *
      *     move 0 to riga.
      *     move low-value to mcg-rec.
      *     start macrogroups key >= mcg-k-desc
      *           invalid continue
      *       not invalid
      *           perform until 1 = 2
      *              add 1 to riga
      *              read macrogroups next at end exit perform end-read
      *              evaluate riga                           
      *              when 1  modify chk-mcg1,  title = mcg-desc, visible = 1, value 1
      *              when 2  modify chk-mcg2,  title = mcg-desc, visible = 1, value 1
      *              when 3  modify chk-mcg3,  title = mcg-desc, visible = 1, value 1
      *              when 4  modify chk-mcg4,  title = mcg-desc, visible = 1, value 1
      *              when 5  modify chk-mcg5,  title = mcg-desc, visible = 1, value 1
      *              when 6  modify chk-mcg6,  title = mcg-desc, visible = 1, value 1
      *              when 7  modify chk-mcg7,  title = mcg-desc, visible = 1, value 1
      *              when 8  modify chk-mcg8,  title = mcg-desc, visible = 1, value 1
      *              when 9  modify chk-mcg9,  title = mcg-desc, visible = 1, value 1
      *              when 10 modify chk-mcg10, title = mcg-desc, visible = 1, value 1
      *              when 11 modify chk-mcg11, title = mcg-desc, visible = 1, value 1
      *              end-evaluate
      *           end-perform
      *     end-start.
      *
      *     move 0 to riga.
      *     move low-value to int-rec.
      *     start intexe key >= int-k-desc
      *           invalid continue
      *       not invalid
      *           perform until 1 = 2
      *              add 1 to riga
      *              read intexe next at end exit perform end-read
      *              evaluate riga                           
      *              when 1  modify chk-int1,  title = int-desc, visible = 1, value 1
      *              when 2  modify chk-int2,  title = int-desc, visible = 1, value 1
      *              when 3  modify chk-int3,  title = int-desc, visible = 1, value 1
      *              when 4  modify chk-int4,  title = int-desc, visible = 1, value 1
      *              when 5  modify chk-int5,  title = int-desc, visible = 1, value 1
      *              when 6  modify chk-int6,  title = int-desc, visible = 1, value 1
      *              when 7  modify chk-int7,  title = int-desc, visible = 1, value 1
      *              when 8  modify chk-int8,  title = int-desc, visible = 1, value 1
      *              when 9  modify chk-int9,  title = int-desc, visible = 1, value 1
      *              when 10 modify chk-int10, title = int-desc, visible = 1, value 1
      *              when 11 modify chk-int11, title = int-desc, visible = 1, value 1
      *              end-evaluate
      *              move int-restpause to el-int-rp(riga)
      *           end-perform
      *     end-start.
      *
      *     move 1 to chk-mcgall-buf chk-intall-buf.
      *     display chk-mcgall chk-intall.
      *
      *     perform INTESTAZIONE.
      *     set ord-mcg-asc to true.
      *     perform LOAD-RECORD.
      *
      *     move 2  to event-data-2.
      *     perform SPOSTAMENTO. 
      *
      *     inquire form1-gd-1(2, 1), hidden-data hiddenData.
      *     move hid-note to ef-note-buf.
      *     display ef-note.
      *
      *     perform INIT.
      *
      *     |specifico dei pgm. con grid-control
      *     perform ABILITAZIONI.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 3
                 PERFORM TOOL-SALVA-LinkTo
              WHEN Key-Status = 1000
                 PERFORM TOOL-CERCA-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON Form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>

           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           perform SALV-MOD.
           if errori
              move 28 to key-status
              exit paragraph
           end-if.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM form1-gd-1-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-twodbook-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-twodbook-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE tod-rec OF twodbook TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     tod-rec OF twodbook
           PERFORM DataSet1-twodbook-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-twodbook-INITSTART
           PERFORM DataSet1-twodbook-START
           IF NOT Valid-STATUS-twodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-twodbook-Read-Next
           IF NOT Valid-STATUS-twodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-twodbook-START-LESS
           IF NOT Valid-STATUS-twodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-twodbook-Read-Prev
           IF NOT Valid-STATUS-twodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-twodbook-START-GREATER
           IF NOT Valid-STATUS-twodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-twodbook-Read-Next
           IF NOT Valid-STATUS-twodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-twodbook-INITEND
           PERFORM DataSet1-twodbook-START-NOTGREATER
           IF NOT Valid-STATUS-twodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-twodbook-Read-Prev
           IF NOT Valid-STATUS-twodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-twodbook-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-STATUS-twodbook
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-twodbook-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-twodbook-Rec-Write
           IF Valid-STATUS-twodbook
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-twodbook-START              
           IF NOT Valid-STATUS-twodbook
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-twodbook-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-twodbook-Rec-Rewrite
           IF Valid-STATUS-twodbook
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-twodbook-Rec-Delete
           IF Valid-STATUS-twodbook
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-twodbook
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-STATUS-twodbook
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE titolo TO TOTEM-MSG-TITLE
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
           set SiSalvato to true.

           .
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-twodbook-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE tod-rec OF twodbook TO 
              TMP-Form1-twodbook-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-twodbook-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-twodbook-RESTOREBUF TO
              tod-rec OF twodbook
           PERFORM DataSet1-twodbook-START
           IF Valid-STATUS-twodbook
              PERFORM DataSet1-twodbook-Read-Next
           ELSE
              PERFORM DataSet1-twodbook-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-twodbook OR
              (Valid-STATUS-twodbook AND
                 tod-rec OF twodbook = 
                   TMP-Form1-twodbook-RESTOREBUF)
              PERFORM DataSet1-twodbook-Read-Next
           END-PERFORM
           .



       Form1-Event-Proc.
           .

       Form1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-End-Drag
           WHEN Msg-Finish-Entry ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Finish-Entry
           WHEN Msg-Goto-Cell ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

      * USER DEFINE PARAGRAPH
       CANCELLA.
      * <TOTEM:PARA. CANCELLA>
      ** <TOTEM:PARA. CANCELLA>
      **--->modifica (isacco)
      *     if mod = 0 exit paragraph end-if.
      **--->fine.                 
      *
      *     display message box MSG-cancellare-il-record-corrente
      *             title = titolo
      *             type mb-yes-no
      *             default mb-no
      *             giving scelta.
      *
      *     if scelta = mb-yes
      *
      *        inquire form1-gd-1, cursor-y in riga
      *        perform VALORE-RIGA
      *
      *        delete exercises record invalid continue end-delete
      *
      *        modify  form1-gd-1, record-to-delete = riga
      *        inquire form1-gd-1, last-row in tot-righe
      *        if riga > tot-righe move tot-righe to riga end-if
      *        modify form1-gd-1, cursor-y = riga, cursor-x = 1
      *        move riga to event-data-2
      *        perform COLORE-RIGA
      *        display message MSG-cancellazione-avvenuta-con-successo
      *                  title titolo
      *     end-if 
           .
      * <TOTEM:END>

       CARICA-CONFRONTI.
      * <TOTEM:PARA. CARICA-CONFRONTI>
           inquire form1-gd-1, last-row in tot-righe.
           perform varying store-riga from 2 by 1 
                     until store-riga > tot-righe
              inquire form1-gd-1(store-riga, 1), hidden-data rod-key
              read rwodbook
              start rwodbook key <= rod-k-confronto
                    invalid continue
                not invalid
                    read rwodbook previous
                    move rod-exe-code to s-rod-exe-code
                    move rod-int-code to s-rod-int-code
                    move rod-day      to s-rod-day     
                    move store-riga to riga  
                    inquire form1-gd-1(store-riga), row-color colore    
                         
                    set trovato to false
                    perform CONFRONTI-GRIGLIA
                    if trovato
                       add 1 to store-riga tot-righe riga
                       move "-" to rec-grid                   
                       modify form1-gd-1, insertion-index riga, 
                                          record-to-add rec-grid 
                       modify form1-gd-1(riga), row-color = 33

                    end-if
              end-start
           end-perform 
           .
      * <TOTEM:END>

       CARICA-WOD.
      * <TOTEM:PARA. CARICA-WOD>
           move como-code to tod-code.
           read twodbook.           
           move low-value to rod-rec.           
           move como-code to rod-code.
           move 1 to riga.
           move 0 to como-giorno.
           start rwodbook key >= rod-key 
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read rwodbook next at end exit perform end-read
                    if rod-code not = tod-code
                       exit perform
                    end-if
                    if como-giorno = 0
                       move rod-day to como-giorno
                    end-if
                    if rod-day not = como-giorno
                       move rod-day to como-giorno
                       if colore = 0 
                          move 304 to colore
                       else
                          move   0 to colore
                       end-if
                    end-if
                    move rod-day to como-data
                    perform DATE-TO-SCREEN 
                    initialize col-exe                 
                    move como-data(1:2) to col-data(1:2)
                    move "/"            to col-data(3:1)  
                    move como-data(3:2) to col-data(4:2)
                    move "/"            to col-data(6:1)  
                    move como-data(5:4) to col-data(7:4)
                    initialize col-exe
                    move rod-exe-code to exe-code
                    read exercises invalid move "NON TROVATA" to 
           exe-desc end-read
                    move exe-desc-stampa to col-exe
                    move rod-series to col-series
                    move rod-reps   to col-reps
                    move rod-int-code to int-code
                    read intexe no lock
                    move int-rest to col-rest

                    if rod-int-restpause > 0
                       move "KG:" to rod-buf(4)
                    end-if
                            
                    move rod-rep(1) to col-rep-1
                    move rod-kg(1)  to col-kg-1
                    move rod-buf(1) to col-buf-1            
                    move rod-rep(2) to col-rep-2
                    move rod-kg(2)  to col-kg-2
                    move rod-buf(2) to col-buf-2
                    move rod-rep(3) to col-rep-3
                    move rod-kg(3)  to col-kg-3
                    move rod-buf(3) to col-buf-3            
                    move rod-rep(4) to col-rep-4
                    move rod-kg(4)  to col-kg-4
                    move rod-buf(4) to col-buf-4
                    move rod-rep(5) to col-rep-5
                    move rod-kg(5)  to col-kg-5
                    move rod-buf(5) to col-buf-5
                    move rod-note   to col-note

                    add 1 to riga                              
                    modify form1-gd-1, record-to-add = rec-grid
                    modify form1-gd-1(riga), row-color = colore
                    modify form1-gd-1(riga, 1), hidden-data = rod-key
                 end-perform
           end-start 
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           move "exercises"  to como-file.
           call "zoom-gt" using como-file, exe-rec
                         giving stato-zoom.
           cancel "zoom-gt".
           if stato-zoom = 0           
              initialize rec-grid
              move exe-desc-stampa to col-exe
              modify form1-gd-1, record-to-add = rec-grid

              move high-value to rod-int-code rod-day
              move exe-code   to s-rod-exe-code rod-exe-code
              move 0          to s-rod-int-code
              inquire form1-gd-1, last-row in riga  
              start rwodbook key <= rod-k-confronto
                    invalid continue
                not invalid
                    perform CONFRONTI-GRIGLIA
              end-start
           end-if 
           .
      * <TOTEM:END>

       COLORE-RIGA.
      * <TOTEM:PARA. COLORE-RIGA>
           if riga < 2 
              move 2 to riga 
           end-if.

           modify form1-gd-1, cursor-color 481 
           .
      * <TOTEM:END>

       CONFRONTI-GRIGLIA.
      * <TOTEM:PARA. CONFRONTI-GRIGLIA>
           perform until 1 = 2
              read rwodbook previous at end exit perform end-read
              if rod-code = tod-code
                 exit perform cycle
              end-if
              if s-rod-int-code = 0
                 if rod-exe-code not = s-rod-exe-code
                    exit perform
                 end-if            
              else
                 if rod-exe-code not = s-rod-exe-code or
                    rod-int-code not = s-rod-int-code
                    exit perform
                 end-if            
              end-if
              move spaces to col-data
              move rod-day to como-data
              perform DATE-TO-SCREEN
              initialize col-exe                 
              move como-data(1:2) to col-exe(1:2)
              move "/"            to col-exe(3:1)  
              move como-data(3:2) to col-exe(4:2)
              move "/"            to col-exe(6:1)  
              move como-data(5:4) to col-exe(7:4)
              move rod-series to col-series
              move rod-reps   to col-reps
              move rod-int-code to int-code
              read intexe no lock
              move int-rest to col-rest

              if rod-int-restpause > 0
                 move "KG:" to rod-buf(4)
              end-if
                   
              move rod-rep(1) to col-rep-1
              move rod-kg(1)  to col-kg-1
              move rod-buf(1) to col-buf-1            
              move rod-rep(2) to col-rep-2
              move rod-kg(2)  to col-kg-2
              move rod-buf(2) to col-buf-2
              move rod-rep(3) to col-rep-3
              move rod-kg(3)  to col-kg-3
              move rod-buf(3) to col-buf-3            
              move rod-rep(4) to col-rep-4
              move rod-kg(4)  to col-kg-4
              move rod-buf(4) to col-buf-4
              move rod-rep(5) to col-rep-5
              move rod-kg(5)  to col-kg-5
              move rod-buf(5) to col-buf-5
              move rod-note   to col-note

              add 1 to riga                       
              set trovato to true
              modify form1-gd-1, insertion-index riga, 
                                 record-to-add rec-grid  
              modify  form1-gd-1(riga), row-color colore
              modify form1-gd-1(riga, 1), hidden-data = rod-key
              add 1 to store-riga tot-righe
           end-perform 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
      *     set tutto-ok to true.
      *     if mod = 0 exit paragraph end-if.
      *
      *     inquire form1-gd-1, cursor-y in riga.
      *
      *     perform VALORE-RIGA.
      *
      *     evaluate colonna
      *     when 78-col-code
      *          if nuovo
      *             if exe-code = zero or spaces 
      *                set errori to true
      *                display message box MSG-Codice-obbligatorio
      *                        title = tit-err
      *                        icon mb-warning-icon
      *             else  
      *                read exercises
      *                     not invalid
      *                         set errori to true
      *                         display message MGS-codice-gia-inserito|"Codice già inserito!"
      *                                 title = tit-err
      *                                 icon mb-warning-icon
      *                end-read
      *             end-if
      *          end-if     
      *     when 78-col-desc
      *          if exe-desc = spaces
      *             set errori to true   
      *             display message box MSG-Descrizione-mancante|"Descrizione mancante"
      *                     title = tit-err
      *                     icon mb-warning-icon
      *          else
      *             if exe-desc-stampa = spaces 
      *                move exe-desc to exe-desc-stampa
      *                modify form1-gd-1(riga, 78-col-desc-stampa), cell-data = exe-desc-stampa
      *             end-if
      *          end-if    
      *     when 78-col-desc-stampa
      *          if exe-desc-stampa = spaces 
      *             move exe-desc to exe-desc-stampa
      *             modify form1-gd-1(riga, 78-col-desc-stampa), cell-data = exe-desc-stampa
      *          end-if
      *     when 78-col-grp-code
      *          move exe-grp-code to grp-code
      *          read groups no lock 
      *               invalid 
      *               move spaces to grp-desc mcg-desc
      *               set errori to true
      *               display message "Gruppo non valido"
      *                     title = tit-err
      *                     icon mb-warning-icon
      *           not invalid
      *               move grp-mcg-code to mcg-code
      *               read macrogroups no lock invalid move spaces to mcg-desc end-read
      *          end-read                                      
      *          modify form1-gd-1(riga, 78-col-grp-desc), cell-data grp-desc
      *          modify form1-gd-1(riga, 78-col-mcg-desc), cell-data mcg-desc  
      *     when 78-col-int-code
      *          move exe-int-code to int-code
      *          read intexe no lock 
      *               invalid 
      *               move spaces to int-desc 
      *               set errori to true
      *               display message "Intensità non valida"
      *                     title = tit-err
      *                     icon mb-warning-icon
      *          end-read                                      
      *          modify form1-gd-1(riga, 78-col-int-desc), cell-data int-desc  
      *
      *     when 78-col-isMulti
      *          if not (exe-isMulti = 0 or 1)
      *             set errori to true
      *             display message "Valori consentiti 1/0"
      *                     title = tit-err
      *                     icon mb-warning-icon
      *          end-if
      *
      *     when 78-col-setting
      *          if exe-setting = 0
      *             set errori to true
      *             display message "Valore obbligatorio"
      *                     title = tit-err
      *                     icon mb-warning-icon
      *          end-if    
      *
      *     when 78-col-restpause
      *          if not (exe-isRestpause = 0 or 1)
      *             set errori to true
      *             display message "Valori consentiti 1/0"
      *                     title = tit-err
      *                     icon mb-warning-icon
      *          end-if
      *
      *     when 78-col-disable
      *          if not (exe-isDisable = 0 or 1)
      *             set errori to true
      *             display message "Valori consentiti 1/0"
      *                     title = tit-err
      *                     icon mb-warning-icon
      *          end-if
      *
      *     end-evaluate.
      *
      *     if errori
      *        modify form1-gd-1, cursor-y = riga, cursor-x = colonna
      *        move riga    to event-data-2
      *        move colonna to event-data-1
      *     end-if 
           .
      * <TOTEM:END>

       INIT.
      * <TOTEM:PARA. INIT>
           set vecchio  to true.
           set tutto-ok to true 
           .
      * <TOTEM:END>

       INTESTAZIONE.
      * <TOTEM:PARA. INTESTAZIONE>
           perform FORM1-GD-1-CONTENT 
           .
      * <TOTEM:END>

       LOAD-RECORD.
      * <TOTEM:PARA. LOAD-RECORD>
           .
      * <TOTEM:END>

       MODIFICA.
      * <TOTEM:PARA. MODIFICA>
      *     inquire tool-modifica, value in mod.
      *
      **--->modifica (isacco)
      *     if nuovo 
      *        move 1 to mod 
      *     else
      *        |specifico per i pgm. con grid-control
      *        if mod = 1
      *           close exercises
      *           open i-o exercises allowing readers
      *        else
      *           set tutto-ok to true
      *
      *           inquire ef-note, value in exe-note
      *           if exe-note not = old-exe-note
      *              set NoSalvato to true
      *           end-if
      *
      *           if NoSalvato
      *              move 1 to mod
      *              perform SALV-MOD
      *           end-if   
      *           if tutto-ok
      *              move 0 to mod
      *              close exercises
      *              open input exercises
      *
      **             | specifico x le tabelle.
      *              | fa in modo che resto sulla cella in cui ero
      *              if ricarica
      *                 set ricarica to false
      *                 modify form1-gd-1, reset-grid = 1
      *                 perform INTESTAZIONE
      *                 perform LOAD-RECORD
      *              end-if
      *
      *           else
      *              move 1 to mod
      *           end-if
      *        end-if
      *     end-if.
      *
      *     perform ABILITAZIONI.
      *
      *     modify tool-modifica, value mod.
      *
      *     display ef-note 
           .
      * <TOTEM:END>

       NUOVO.
      * <TOTEM:PARA. NUOVO>
      *     set tutto-ok to true.
      *
      *     if nuovo
      *        perform VALORE-RIGA
      *        if exe-code not = spaces
      *           perform SALVA
      *        else
      *           set errori to true
      *        end-if
      *     end-if.
      *
      *     if tutto-ok
      *        set nuovo to true
      *        inquire form1-gd-1,  last-row in tot-righe
      *        modify  form1-gd-1,  insert-rows = 1
      *        modify  form1-gd-1,  cursor-x    = 1 
      *                             cursor-y    = tot-righe + 1
      *        move 1 to mod
      *        modify  tool-modifica,   value = mod
      *
      *        add 1 to tot-righe giving riga
      *
      *        perform ABILITAZIONI
      *
      *        move spaces to ef-note-buf
      *        display ef-note
      *
      *        initialize old-exe-rec replacing numeric data by zeroes
      *                                    alphanumeric data by spaces
      *        add 1 to tot-righe giving event-data-2
      *        perform COLORE-RIGA
      *     end-if 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "utydata.cpy" 
           .
      * <TOTEM:END>

       SALV-MOD.
      * <TOTEM:PARA. SALV-MOD>
      *     if nuovo
      *        perform VALORE-RIGA
      *        if exe-rec not = old-exe-rec
      *           set NoSalvato to true
      *        else
      *           set SiSalvato to true
      *        end-if
      *     else
      *         inquire ef-note, value in exe-note
      *         if exe-note not = old-exe-note
      *            set NoSalvato to true
      *         end-if
      *     end-if.
      *
      *     set tutto-ok to true.
      *     if NoSalvato
      *        display message box MSG-Salvare-le-modifiche, 
      *                       title = titolo
      *                       type = mb-yes-no-cancel
      *                       giving scelta
      *
      *        evaluate scelta
      *        when mb-yes    perform SALVA
      *        when mb-cancel set errori    to true
      *        when mb-no     set tutto-ok  to true
      *                       set SiSalvato to true
      *                       set ricarica  to true
      *        end-evaluate
      *
      *     end-if 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
           inquire form1-gd-1, last-row in tot-righe.
           perform varying riga from 2 by 1 
                     until riga > tot-righe
              inquire form1-gd-1(riga, 1), hidden-data rod-key
              read rwodbook
              inquire form1-gd-1(riga, 78-col-rep-1), cell-data in 
           col-rep-1
              inquire form1-gd-1(riga, 78-col-kg-1 ), cell-data in 
           col-kg-1 
              inquire form1-gd-1(riga, 78-col-buf-1), cell-data in 
           col-buf-1
              inquire form1-gd-1(riga, 78-col-rep-2), cell-data in 
           col-rep-2
              inquire form1-gd-1(riga, 78-col-kg-2 ), cell-data in 
           col-kg-2 
              inquire form1-gd-1(riga, 78-col-buf-2), cell-data in 
           col-buf-2
              inquire form1-gd-1(riga, 78-col-rep-3), cell-data in 
           col-rep-3
              inquire form1-gd-1(riga, 78-col-kg-3 ), cell-data in 
           col-kg-3 
              inquire form1-gd-1(riga, 78-col-buf-3), cell-data in 
           col-buf-3
              inquire form1-gd-1(riga, 78-col-rep-4), cell-data in 
           col-rep-4
              inquire form1-gd-1(riga, 78-col-kg-4 ), cell-data in 
           col-kg-4 
              inquire form1-gd-1(riga, 78-col-buf-4), cell-data in 
           col-buf-4
              inquire form1-gd-1(riga, 78-col-rep-5), cell-data in 
           col-rep-5
              inquire form1-gd-1(riga, 78-col-kg-5 ), cell-data in 
           col-kg-5 
              inquire form1-gd-1(riga, 78-col-buf-5), cell-data in 
           col-buf-5
              inquire form1-gd-1(riga, 78-col-note ), cell-data in 
           col-note 
              move col-rep-1 to rod-rep(1)
              move col-kg-1  to rod-kg(1)
              move col-buf-1 to rod-buf(1)
              move col-rep-2 to rod-rep(2)
              move col-kg-2  to rod-kg(2) 
              move col-buf-2 to rod-buf(2)
              move col-rep-3 to rod-rep(3)
              move col-kg-3  to rod-kg(3) 
              move col-buf-3 to rod-buf(3)
              move col-rep-4 to rod-rep(4)
              move col-kg-4  to rod-kg(4) 
              move col-buf-4 to rod-buf(4)
              move col-rep-5 to rod-rep(5)
              move col-kg-5  to rod-kg(5) 
              move col-buf-5 to rod-buf(5)
              move col-note  to rod-note
              rewrite rod-rec
           end-perform 
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           if event-data-1 <= 78-col-rest
              set event-action to event-action-fail
           else
              perform COLORE-RIGA
           end-if 
           .
      * <TOTEM:END>

       VALORE-RIGA.
      * <TOTEM:PARA. VALORE-RIGA>
      *     inquire form1-gd-1(riga, 78-col-code),      hidden-data hiddenData.
      *
      *     inquire form1-gd-1(riga, 78-col-code),        cell-data exe-code.
      *     inquire form1-gd-1(riga, 78-col-desc),        cell-data exe-desc.  
      *     inquire form1-gd-1(riga, 78-col-desc-stampa), cell-data exe-desc-stampa
      *     inquire form1-gd-1(riga, 78-col-grp-code),    cell-data exe-grp-code.
      *     inquire form1-gd-1(riga, 78-col-int-code),    cell-data exe-int-code.
      *     inquire form1-gd-1(riga, 78-col-ismulti),     cell-data exe-isMulti.
      *     inquire form1-gd-1(riga, 78-col-setting),     cell-data exe-setting.
      *     inquire form1-gd-1(riga, 78-col-restpause),   cell-data exe-isRestpause. 
      *     inquire form1-gd-1(riga, 78-col-disable),     cell-data exe-isDisable. 
      *
      *     move ef-note-buf to exe-note 
           .
      * <TOTEM:END>

       VALORE-OLD-RIGA.
      * <TOTEM:PARA. VALORE-OLD-RIGA>
      *     if vecchio
      *        inquire form1-gd-1(riga, 78-col-code) cell-data old-exe-code
      *        move old-exe-code           to exe-code
      *        read exercises              no lock
      *        move exe-rec                to old-exe-rec
      *     else
      *        initialize old-exe-rec replacing numeric data by zeroes
      *                                    alphanumeric data by spaces
      *     end-if.
      *
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       TOOL-SALVA-LinkTo.
      * <TOTEM:PARA. TOOL-SALVA-LinkTo>
           inquire tool-salva, enabled in e-salva.
           if e-salva = 1
              perform SALVA
           end-if 
           .
      * <TOTEM:END>
       I-O-BLOCCO.
      * <TOTEM:PARA. I-O-BLOCCO>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM 
           .
      * <TOTEM:END>
       PAS004P-Ev-Before-Program.
      * <TOTEM:PARA. PAS004P-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID.
           call "C$NARG" using ws-narg.
           if ws-narg < 2
              move 0 to como-code
           else
              move lnk-code to como-code
           end-if 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Finish-Entry.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Finish-Entry>
           inquire form1-gd-1, cursor-y in riga.
           perform VALORE-RIGA.

           set environment "KEYSTROKE" to "DATA=44 44".
           set environment "KEYSTROKE" to "DATA=46 46".

           perform  CONTROLLO.

           if errori 
              set event-action to event-action-fail 
              perform VALORE-RIGA
           end-if.

           if exe-rec not = old-exe-rec
              set NoSalvato to true                            
           else 
              set SiSalvato to true
           end-if 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Begin-Entry>
           inquire form1-gd-1, cursor-x = colonna,
                               cursor-y in riga.
                         
      *     perform VALORE-RIGA.

      
           if confronto
              set event-action to event-action-fail
           else
              evaluate colonna 
              when 78-col-data 
              when 78-col-exe 
              when 78-col-series 
              when 78-col-rest 
              when 78-col-rest
                   set event-action to event-action-fail
              when 78-col-buf-4
                   inquire form1-gd-1(riga, colonna), cell-data in 
           col-buf-4
                   if col-buf-4 = "KG:"                 
                      set event-action to event-action-fail
                   end-if
              end-evaluate 
           end-if 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca.
           if e-cerca = 1
              perform CERCA
           end-if 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

